# Исправление корзины - 06.11.2025, 17:01

## Проблема
❌ При нажатии кнопок +/- в корзине не происходило:
- Увеличение/уменьшение количества товара
- Пересчет цены позиции
- Обновление общей суммы корзины

## Причины
1. **Неверные селекторы** - искал `.cart-item-price`, а нужен `.subtotal`
2. **Неправильный формат валюты** - несоответствие между backend (float) и frontend (строка "X,XX Br")
3. **Отсутствие счетчика** - backend не возвращал `count`

## Исправления

### 1. Frontend - `/web/js/cart.js`
✅ Исправлена функция `updateCartItem()`:
- Валидация количества (1-99)
- Правильные селекторы: `.subtotal`, `input[type="number"]`, `.price-per-item`
- Обновление всех элементов UI (подытог, инпут, кнопки, общая сумма)
- Добавлено уведомление об успехе

✅ Добавлена функция `formatCurrency()`:
- Форматирует числа в белорусский формат "X,XX Br"
- Используется для всех цен в корзине

### 2. Backend - `/controllers/CartController.php`
✅ Метод `actionUpdate()`:
- Добавлено явное приведение к `float`
- Возвращается `count` (количество товаров в корзине)

### 3. Модальное окно - `/views/cart/index.php`
✅ Функция `updateCartTotals()`:
- Обновляет сумму товаров в модальном окне оформления
- Пересчитывает итоговую сумму с учетом доставки

✅ Функция `updateDeliveryCost()`:
- Исправлен парсинг белорусского формата валюты

## Результат
✅ **Кнопки +/-** работают мгновенно
✅ **Подытог** обновляется для каждой позиции
✅ **Общая сумма** пересчитывается во всех блоках
✅ **Счетчик в header** обновляется
✅ **Кнопка "минус"** становится disabled при количестве = 1
✅ **Инпут количества** синхронизируется с актуальным значением
✅ **Уведомления** показываются при успешных операциях

## Как проверить

1. **Откройте корзину** - `/cart`
2. **Добавьте товары** (если корзина пуста)
3. **Нажмите кнопку +** - количество увеличится, цена пересчитается
4. **Нажмите кнопку -** - количество уменьшится, цена пересчитается
5. **Введите число в инпут** - изменения применятся при потере фокуса
6. **Проверьте счетчик** в header - должен обновиться
7. **Откройте модальное окно оформления** - сумма должна быть актуальной

## Файлы
- `/web/js/cart.js` - исправлена логика обновления
- `/controllers/CartController.php` - добавлен count в ответ
- `/views/cart/index.php` - улучшена синхронизация UI
- `/PROJECT_TASKS.md` - добавлена задача в историю
