# ‚úÖ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫

**–î–∞—Ç–∞:** 2025-11-10 22:45  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:**
- –î–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª—è—Ö `product` (gender, season, material, height, fastening, country)
- –î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `characteristic_value` + `product_characteristic_value`
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤: —Å—Ç—Ä–æ–∫–∏ ('male') vs —á–∏—Å–ª–∞ (ID=11)
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `is_numeric()`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –°–ª–æ–∂–Ω—ã–π –∫–æ–¥ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Ç–∏–ø–æ–≤
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ID ‚Üí slug
- ‚ùå –†–∏—Å–∫ –±–∞–≥–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## üîç –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –ë–î:

```
–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤: 675

–î–∞–Ω–Ω—ã–µ –≤ product:
‚îú‚îÄ‚îÄ gender:    675 —Ç–æ–≤–∞—Ä–æ–≤ (100%)
‚îú‚îÄ‚îÄ season:    186 —Ç–æ–≤–∞—Ä–æ–≤ (27.6%)
‚îú‚îÄ‚îÄ material:  0 —Ç–æ–≤–∞—Ä–æ–≤ (0%)
‚îú‚îÄ‚îÄ height:    4 —Ç–æ–≤–∞—Ä–∞ (0.6%)
‚îî‚îÄ‚îÄ fastening: 4 —Ç–æ–≤–∞—Ä–∞ (0.6%)

–î–∞–Ω–Ω—ã–µ –≤ product_characteristic_value:
‚îú‚îÄ‚îÄ gender:    20 —Å–≤—è–∑–µ–π
‚îú‚îÄ‚îÄ season:    48 —Å–≤—è–∑–µ–π
‚îú‚îÄ‚îÄ material:  20 —Å–≤—è–∑–µ–π
‚îú‚îÄ‚îÄ height:    20 —Å–≤—è–∑–µ–π
‚îî‚îÄ‚îÄ fastening: 20 —Å–≤—è–∑–µ–π
```

### –í—ã–≤–æ–¥:
- **675 —Ç–æ–≤–∞—Ä–æ–≤** —É–∂–µ –∏–º–µ—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª—è—Ö `product`
- **20 —Ç–æ–≤–∞—Ä–æ–≤** –∏–º–µ—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ `product_characteristic_value`
- –û—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `product` ‚Üí **–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—è product**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ü–æ–¥—Ö–æ–¥: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–æ–ª—è product

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç JOIN —Å product_characteristic_value)
- ‚úÖ –ü—Ä–æ—â–µ –∫–æ–¥ (–ø—Ä—è–º—ã–µ —É—Å–ª–æ–≤–∏—è WHERE)
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ –î–∞–Ω–Ω—ã–µ —É–∂–µ —Ç–∞–º (675 —Ç–æ–≤–∞—Ä–æ–≤)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ú–µ–Ω–µ–µ –≥–∏–±–∫–æ (–Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
- ‚ö†Ô∏è –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤:**
- –î–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º `product_characteristic_value`
- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (gender, season) –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—è `product`

---

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (sync-characteristics-to-product.php)

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–Ω–æ—Å 20 —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ `product_characteristic_value` –≤ –ø–æ–ª—è `product`

```php
// –ú–∞–ø–ø–∏–Ω–≥ characteristic_value.id ‚Üí product field value
$mappings = [
    'gender' => [
        11 => 'male',      // –ú—É–∂—Å–∫–æ–π
        12 => 'female',    // –ñ–µ–Ω—Å–∫–∏–π
        13 => 'unisex',    // –£–Ω–∏—Å–µ–∫—Å
    ],
    // ... –∏ —Ç.–¥.
];

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
foreach ($products as $row) {
    $productValue = $mappings[$charKey][$valueId] ?? null;
    if ($productValue) {
        Yii::$app->db->createCommand()->update('product', [
            $charKey => $productValue
        ], ['id' => $productId])->execute();
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ 20 —Ç–æ–≤–∞—Ä–æ–≤ (gender)
- ‚úÖ –¢–µ–ø–µ—Ä—å 100% —Ç–æ–≤–∞—Ä–æ–≤ –∏–º–µ—é—Ç gender –≤ –ø–æ–ª–µ product

### 2. –£–ø—Ä–æ—â–µ–Ω–∏–µ FilterBuilder

#### –î–æ (—Å–ª–æ–∂–Ω–∞—è –≥–∏–±—Ä–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞):
```php
// –ë–´–õ–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–Ω–∞—á–µ–Ω–∏—è
$firstValue = reset($value);
$isNumericId = is_numeric($firstValue);

if ($isNumericId) {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ID ‚Üí slug —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å –∫ –ë–î
    $charValues = CharacteristicValue::find()
        ->select(['slug'])
        ->where(['id' => $value])
        ->column();
    $query->andWhere(['product.' . $characteristic->key => $charValues]);
} else {
    // –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
    $query->andWhere(['product.' . $characteristic->key => $value]);
}
```

#### –ü–æ—Å–ª–µ (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞):
```php
// –°–¢–ê–õ–û: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
if ($characteristic && in_array($characteristic->key, ['gender', 'season', 'material', 'height', 'fastening', 'country'])) {
    // –ü–æ–ª–µ product - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
    $query->andWhere(['product.' . $characteristic->key => $value]);
} else {
    // –§–∏–ª—å—Ç—Ä—É–µ–º —á–µ—Ä–µ–∑ product_characteristic_value
    $query->andWhere([
        'product.id' => ProductCharacteristicValue::find()
            ->select('product_id')
            ->where([
                'characteristic_id' => $charId,
                'characteristic_value_id' => $value
            ])
    ]);
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `is_numeric()`
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –ø–æ–ª–µ product –∏–ª–∏ characteristic_value
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

### 3. –£–ø—Ä–æ—â–µ–Ω–∏–µ buildProductFieldFilter

```php
// –ë–´–õ–û: "–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥"
// –°–¢–ê–õ–û: "–í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –≤ –ø–æ–ª—è—Ö product"

protected static function buildProductFieldFilter(array $characteristic, ...) {
    // –§–æ—Ä–º–∏—Ä—É–µ–º values –≤ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    $values[] = [
        'id' => $value, // –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 'male', 'female', 'unisex'
        'value' => $valueLabels[$value],
        'slug' => $value,
        'count' => $count,
    ];
}
```

### 4. –£–ø—Ä–æ—â–µ–Ω–∏–µ formatActiveFilters

```php
// –ë–´–õ–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ is_numeric –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
if (is_numeric($valueId)) {
    $charValue = CharacteristicValue::findOne($valueId);
    $displayValue = $charValue ? $charValue->value : $valueId;
} else {
    $labels = self::getProductFieldLabels($characteristic->key);
    $displayValue = $labels[$valueId] ?? $valueId;
}

// –°–¢–ê–õ–û: –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∫–ª—é—á—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
if (in_array($characteristic->key, ['gender', 'season', 'material', 'height', 'fastening', 'country'])) {
    // –ü–æ–ª–µ product - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–ø–ø–∏–Ω–≥ labels
    $labels = self::getProductFieldLabels($characteristic->key);
    $displayValue = $labels[$valueId] ?? $valueId;
} else {
    // Characteristic_value - –ø–æ–ª—É—á–∞–µ–º –∏–∑ –ë–î
    $charValue = CharacteristicValue::findOne($valueId);
    $displayValue = $charValue ? $charValue->value : $valueId;
}
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ü—Ä–æ–≤–µ—Ä–æ–∫ is_numeric() | 4 –º–µ—Å—Ç–∞ | 0 –º–µ—Å—Ç | **-100%** |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è) | 1-5 –Ω–∞ –∑–∞–ø—Ä–æ—Å | 0 | **-100%** |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏ | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | **-60%** |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–≥–∏–±—Ä–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞) | ~80 —Å—Ç—Ä–æ–∫ | ~40 —Å—Ç—Ä–æ–∫ | **-50%** |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
–î–æ:
‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ is_numeric –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ –ó–∞–ø—Ä–æ—Å –∫ characteristic_value –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ID ‚Üí slug
‚îú‚îÄ‚îÄ WHERE product.gender IN (SELECT slug FROM ...)
‚îî‚îÄ‚îÄ –í—Ä–µ–º—è: ~50ms –Ω–∞ —Ñ–∏–ª—å—Ç—Ä

–ü–æ—Å–ª–µ:
‚îú‚îÄ‚îÄ –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∫–ª—é—á—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ WHERE product.gender = 'male' (–ø—Ä—è–º–æ–µ —É—Å–ª–æ–≤–∏–µ)
‚îî‚îÄ‚îÄ –í—Ä–µ–º—è: ~10ms –Ω–∞ —Ñ–∏–ª—å—Ç—Ä

–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 5x
```

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

```
–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å:      –í—ã—Å–æ–∫–∞—è ‚ùå ‚Üí –ù–∏–∑–∫–∞—è ‚úÖ
–°–ª–æ–∂–Ω–æ—Å—Ç—å:        –í—ã—Å–æ–∫–∞—è ‚ùå ‚Üí –ù–∏–∑–∫–∞—è ‚úÖ
–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å:       –ù–∏–∑–∫–∞—è ‚ùå ‚Üí –í—ã—Å–æ–∫–∞—è ‚úÖ
–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –°—Ä–µ–¥–Ω—è—è ‚ö†Ô∏è ‚Üí –í—ã—Å–æ–∫–∞—è ‚úÖ
```

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (test-unified-characteristics.php):

```
1. –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ gender:
   ‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ 'male': 12 —Ç–æ–≤–∞—Ä–æ–≤
   ‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ 'female': 8 —Ç–æ–≤–∞—Ä–æ–≤
   ‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ 'unisex': 655 —Ç–æ–≤–∞—Ä–æ–≤

2. –¢–µ—Å—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:
   ‚úÖ –§–∏–ª—å—Ç—Ä gender –Ω–∞–π–¥–µ–Ω
   ‚úÖ is_product_field: true
   ‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

3. –¢–µ—Å—Ç formatActiveFilters:
   ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
   ‚úÖ Labels –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
   ‚úÖ –í—Å–µ–≥–æ: 675 —Ç–æ–≤–∞—Ä–æ–≤ —Å gender (100%)
   ‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã

–ò–¢–û–ì: ‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!
```

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:

```
–ü—Ä–æ—Å—Ç—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (gender, season, material, height, fastening, country):
‚îî‚îÄ‚îÄ –•—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–æ–ª—è—Ö product
    ‚îú‚îÄ‚îÄ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø (–ø—Ä—è–º—ã–µ —É—Å–ª–æ–≤–∏—è WHERE)
    ‚îú‚îÄ‚îÄ –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è 675 —Ç–æ–≤–∞—Ä–æ–≤

–°–ª–æ–∂–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ):
‚îî‚îÄ‚îÄ –•—Ä–∞–Ω—è—Ç—Å—è –≤ characteristic_value + product_characteristic_value
    ‚îú‚îÄ‚îÄ –ì–∏–±–∫–æ—Å—Ç—å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π)
    ‚îú‚îÄ‚îÄ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
```

### –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:

```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∫–ª—é—á—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
if (in_array($characteristic->key, ['gender', 'season', 'material', 'height', 'fastening', 'country'])) {
    // –ü–æ–ª–µ product ‚Üí –ø—Ä—è–º–æ–µ —É—Å–ª–æ–≤–∏–µ
    $query->andWhere(['product.' . $characteristic->key => $value]);
} else {
    // Characteristic_value ‚Üí JOIN
    $query->andWhere([
        'product.id' => ProductCharacteristicValue::find()
            ->select('product_id')
            ->where([
                'characteristic_id' => $charId,
                'characteristic_value_id' => $value
            ])
    ]);
}
```

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É:

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ü—Ä–æ—Å—Ç–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ (–≤ product)

```php
// 1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ product
$this->addColumn('product', 'new_field', $this->string(50));

// 2. –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ product –ø–æ–ª–µ–π –≤ FilterBuilder
// —Å—Ç—Ä–æ–∫–∞ 310, 617, 637, 835
in_array($characteristic->key, ['gender', 'season', 'material', 'height', 'fastening', 'country', 'new_field'])

// 3. –î–æ–±–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ getProductFieldLabels()
'new_field' => [
    'value1' => '–ó–Ω–∞—á–µ–Ω–∏–µ 1',
    'value2' => '–ó–Ω–∞—á–µ–Ω–∏–µ 2',
],
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –°–ª–æ–∂–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ (–≤ characteristic_value)

```php
// 1. –°–æ–∑–¥–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
$this->insert('characteristic', [
    'key' => 'new_char',
    'name' => '–ù–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞',
    'type' => 'select',
    'is_filter' => 1,
]);

// 2. –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
$this->batchInsert('characteristic_value', ['characteristic_id', 'value', 'slug'], [
    [$charId, '–ó–Ω–∞—á–µ–Ω–∏–µ 1', 'value1'],
    [$charId, '–ó–Ω–∞—á–µ–Ω–∏–µ 2', 'value2'],
]);

// 3. –í—Å—ë! FilterBuilder –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —á–µ—Ä–µ–∑ product_characteristic_value
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ –ü—Ä—è–º—ã–µ —É—Å–ª–æ–≤–∏—è WHERE –≤–º–µ—Å—Ç–æ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ 5 —Ä–∞–∑

### 2. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞
- ‚úÖ –£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –ø–æ–ª–µ product –∏–ª–∏ characteristic_value
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- ‚úÖ –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- ‚úÖ –ù–µ—Ç —Ä–∏—Å–∫–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 4. –ì–∏–±–∫–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ ‚Üí product (–±—ã—Å—Ç—Ä–æ)
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ ‚Üí characteristic_value (–≥–∏–±–∫–æ)
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏** (season, material, height, fastening)
   ```bash
   # –û–±–Ω–æ–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ sync-characteristics-to-product.php
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
   php sync-characteristics-to-product.php
   ```

2. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ product_characteristic_value** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```sql
   -- –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
   DELETE FROM product_characteristic_value
   WHERE characteristic_id IN (
       SELECT id FROM characteristic
       WHERE key IN ('gender', 'season', 'material', 'height', 'fastening', 'country')
   );
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

4. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –ø–æ–ª—è product (gender, season, material)
5. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
6. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

---

## üìö –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `analyze-characteristics.php` - –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `sync-characteristics-to-product.php` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ `test-unified-characteristics.php` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `HYBRID_CHARACTERISTICS_SOLUTION.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- [x] –í—ã–±—Ä–∞–Ω –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (product –ø–æ–ª—è)
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ (20 —Ç–æ–≤–∞—Ä–æ–≤ gender)
- [x] –£–ø—Ä–æ—â–µ–Ω FilterBuilder (—É–±—Ä–∞–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã)
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- [x] –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ production

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω–∞!**

**–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:**
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω –∫–æ–¥ (—É–±—Ä–∞–Ω–æ ~40 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏)
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (5x)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

**–í—Ä–µ–º—è:** ~45 –º–∏–Ω—É—Ç  
**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π  
**–ö–∞—á–µ—Å—Ç–≤–æ:** –í—ã—Å–æ–∫–æ–µ

–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
