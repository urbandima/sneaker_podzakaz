# üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Poizon/Dewu - –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Poizon/Dewu —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Poizon
- –í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—É–≤–∏ (–º–∞—Ç–µ—Ä–∏–∞–ª, —Å–µ–∑–æ–Ω, –ø–æ–ª, –≤—ã—Å–æ—Ç–∞ –∏ —Ç.–¥.)
- –†–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏ US/EU/UK/CM —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π
- CDN –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç Poizon (–Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
- –§–æ—Ä–º—É–ª–∞ —Ü–µ–Ω: **CNY √ó –∫—É—Ä—Å √ó 1.5 + 40 BYN**

### üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏
- –ö–∞–∂–¥—ã–π –∏–º–ø–æ—Ä—Ç –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î (—Ç–∞–±–ª–∏—Ü—ã `import_batch`, `import_log`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ/–ø—Ä–æ–ø—É—â–µ–Ω–æ/–æ—à–∏–±–æ–∫
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

### üéõÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- URL: `/admin-import`
- Dashboard —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∏ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### ‚ö° Real-time API
- Endpoint `/admin-import/check-size` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ä–∞–∑–º–µ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
- –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–ª–∏—á–∏–∏ —Å Poizon

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- Cron —Å–∫—Ä–∏–ø—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (dry-run) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/Users/user/CascadeProjects/splitwise/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ m251104_120000_add_poizon_fields_to_product.php    # –ü–æ–ª—è Poizon
‚îÇ   ‚îú‚îÄ‚îÄ m251104_120100_update_product_size_with_grids.php  # –†–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ m251104_120200_create_import_tables.php            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ ImportBatch.php          # –ú–æ–¥–µ–ª—å –±–∞—Ç—á–∞ –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ ImportLog.php            # –ú–æ–¥–µ–ª—å –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Product.php              # –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø–æ–ª—è–º–∏ Poizon
‚îÇ   ‚îî‚îÄ‚îÄ ProductSize.php          # –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å —Ä–∞–∑–º–µ—Ä–Ω—ã–º–∏ —Å–µ—Ç–∫–∞–º–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ PoizonApiService.php     # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å Poizon API
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îî‚îÄ‚îÄ PoizonImportController.php  # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ AdminImportController.php   # –í–µ–±-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–º–ø–æ—Ä—Ç–∞
‚îú‚îÄ‚îÄ views/admin-import/
‚îÇ   ‚îú‚îÄ‚îÄ index.php                # Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ run.php                  # –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ view.php                 # –î–µ—Ç–∞–ª–∏ –±–∞—Ç—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ errors.php               # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ web.php                  # –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç poizonApi
‚îÇ   ‚îî‚îÄ‚îÄ params.php               # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Poizon (URL, –∫–ª—é—á, –∫—É—Ä—Å)
‚îú‚îÄ‚îÄ POIZON_INTEGRATION.md        # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (50+ —Å—Ç—Ä–∞–Ω–∏—Ü)
‚îú‚îÄ‚îÄ POIZON_QUICK_START.md        # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ POIZON_README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ poizon-import-cron.sh        # –°–∫—Ä–∏–ø—Ç –¥–ª—è cron
```

## –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
php yii poizon-import/run --limit=100

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
php yii poizon-import/test

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
php yii poizon-import/logs

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
php yii poizon-import/update-prices

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
php yii poizon-import/update-sizes
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **PHP:** 7.4+
- **–î–æ—Å—Ç—É–ø –∫ Poizon API** –∏–ª–∏ XML —Ñ–∏–¥—É
- **Cron** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- **–†–æ–ª—å admin** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config/params.php

```php
// URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö Poizon
'poizonXmlUrl' => 'https://your-xml-feed.xml',

// API –∫–ª—é—á (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
'poizonApiKey' => 'your_api_key',

// –ö—É—Ä—Å CNY -> BYN
'cnyToBynRate' => 0.45,
```

### config/web.php

```php
'components' => [
    'poizonApi' => [
        'class' => 'app\components\PoizonApiService',
        'apiUrl' => $params['poizonApiUrl'] ?? 'https://api.poizon-parser.com/v1',
        'apiKey' => $params['poizonApiKey'] ?? null,
        'timeout' => 30,
    ],
    // ...
],
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**import_batch** - –ë–∞—Ç—á–∏ –∏–º–ø–æ—Ä—Ç–∞
- id, source, type, status
- started_at, finished_at, duration_seconds
- total_items, created_count, updated_count, error_count
- config (JSON), summary (JSON)

**import_log** - –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
- id, batch_id, product_id, action, level
- sku, poizon_id, product_name
- message, data (JSON), error_details

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**product** - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- sku (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π SKU)
- poizon_id, poizon_spu_id, poizon_url
- poizon_price_cny, last_sync_at
- upper_material, sole_material, color_description
- style_code, release_year, is_limited, weight

**product_size** - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- us_size, eu_size, uk_size, cm_size
- poizon_sku_id, poizon_stock, poizon_price_cny

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** –∏–∑ Poizon API/XML
2. **–ü–∞—Ä—Å–∏–Ω–≥** –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. **–°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**:
   - SKU: `POIZON-{BRAND}-{STYLE_CODE}`
   - –¶–µ–Ω–∞: `CNY √ó 0.45 √ó 1.5 + 40 BYN`
   - –°—Ç–∞—Ç—É—Å: "–ü–æ–¥ –∑–∞–∫–∞–∑" (14-30 –¥–Ω–µ–π)
4. **–ò–º–ø–æ—Ä—Ç —Ä–∞–∑–º–µ—Ä–æ–≤**:
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ US/EU/UK/CM
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
5. **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
   - –ü–æ–ª (male/female/unisex)
   - –°–µ–∑–æ–Ω (summer/winter/demi/all)
   - –í—ã—Å–æ—Ç–∞ (low/mid/high)
   - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ü–≤–µ—Ç, –∫–æ–¥ –º–æ–¥–µ–ª–∏
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ import_log

### –§–æ—Ä–º—É–ª–∞ —Ü–µ–Ω—ã

```
–¶–µ–Ω–∞ BYN = (–¶–µ–Ω–∞ CNY √ó –ö—É—Ä—Å √ó 1.5) + 40 BYN

–ü—Ä–∏–º–µ—Ä:
- –¢–æ–≤–∞—Ä –Ω–∞ Poizon: 899 CNY
- –ö—É—Ä—Å: 1 CNY = 0.45 BYN
- –†–∞—Å—á–µ—Ç: (899 √ó 0.45 √ó 1.5) + 40 = 606.83 + 40 = 646.83 BYN
```

### –†–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤:
- **US ‚Üí EU, UK, CM**
- **EU ‚Üí US, UK, CM**
- **UK ‚Üí US, EU, CM**
- **CM ‚Üí US, EU, UK**

–ü—Ä–∏–º–µ—Ä:
- US 9 = EU 42 = UK 8 = 27 CM

## –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω (–±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä–æ–≤ (–±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- [ ] Webhooks –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –∏–º–ø–æ—Ä—Ç–µ
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ Excel
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç —á–µ—Ä–µ–∑ API

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `POIZON_INTEGRATION.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `POIZON_QUICK_START.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–õ–æ–≥–∏:**
```bash
# –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏
php yii poizon-import/logs

# –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏
tail -f runtime/logs/app.log
tail -f runtime/logs/poizon-import.log

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM import_batch ORDER BY id DESC LIMIT 10;
SELECT * FROM import_log WHERE action = 'error' ORDER BY id DESC LIMIT 20;
```

**–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
- URL: `/admin-import`
- –¢—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å: admin

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `POIZON_INTEGRATION.md`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `php yii poizon-import/logs`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `/admin-import`

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 04.11.2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
