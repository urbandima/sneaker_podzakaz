# –û—Ç—á–µ—Ç –æ–± –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ

**–î–∞—Ç–∞:** 2025-11-10  
**–ê–Ω–∞–ª–∏–∑:** –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–ª–æ—Ö–∏—Ö —Å–≤—è–∑–µ–π –∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –õ–û–ì–ò–ö–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò** (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—É—â–µ—Å—Ç–≤—É–µ—Ç –î–í–ê –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–º—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º:

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 1: `SmartFilter` (components/SmartFilter.php)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** SEF URL –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `generateSefUrl()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ß–ü–£ URL
  - `parseSefUrl()` - –ø–∞—Ä—Å–∏–Ω–≥ –ß–ü–£ URL
  - `formatActiveFilters()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
  - `generateDynamicH1()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è H1
  - `getCanonicalUrl()` - canonical URL
  - `getRobotsDirective()` - robots meta

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 2: `FilterBuilder` (services/Catalog/FilterBuilder.php)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å–∞–º
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `buildFilters()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
  - `applyFiltersToProductQuery()` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫ –∑–∞–ø—Ä–æ—Å—É
  - `buildBrandsFilter()` - —Ñ–∏–ª—å—Ç—Ä –±—Ä–µ–Ω–¥–æ–≤
  - `buildCategoriesFilter()` - —Ñ–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  - `buildCharacteristicsFilters()` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∏:**
```php
// –í CatalogController –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –û–ë–ê –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
use app\components\SmartFilter;           // ‚Üê –î–ª—è SEF URL
use app\services\Catalog\FilterBuilder;   // ‚Üê –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

// –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏:
$activeFilters = SmartFilter::formatActiveFilters($filters);  // ‚Üê –î—É–±–ª—å 1
$activeFilters = $this->getActiveFilters($currentFilters);    // ‚Üê –î—É–±–ª—å 2 (–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (2 –º–µ—Å—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤)
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏ (SmartFilter –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö)
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤ 2 –º–µ—Å—Ç–∞—Ö)
- ‚ùå –ü—É—Ç–∞–Ω–∏—Ü–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–∫–∞–∫–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?)

**–†–µ—à–µ–Ω–∏–µ:**
```
–í–∞—Ä–∏–∞–Ω—Ç –ê: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å FilterService
  - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å SEF URL –ª–æ–≥–∏–∫—É –≤ FilterBuilder
  - –£–¥–∞–ª–∏—Ç—å SmartFilter
  
–í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
  - SmartFilter ‚Üí —Ç–æ–ª—å–∫–æ SEF URL (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–ø–∞—Ä—Å–∏–Ω–≥)
  - FilterBuilder ‚Üí —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å–∞–º
  - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ formatActiveFilters()
```

---

### 2. **–ì–ò–ë–†–ò–î–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö** (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –î–í–£–• –º–µ—Å—Ç–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

#### –ú–µ—Å—Ç–æ 1: –¢–∞–±–ª–∏—Ü–∞ `product` (–ø—Ä—è–º—ã–µ –ø–æ–ª—è)
```sql
product.gender     ‚Üí 'male', 'female', 'unisex'
product.season     ‚Üí 'summer', 'winter', 'demi', 'all'
product.material   ‚Üí 'leather', 'textile', 'synthetic'
product.height     ‚Üí 'low', 'mid', 'high'
product.fastening  ‚Üí 'laces', 'velcro', 'zipper', 'slip_on'
product.country    ‚Üí —Å—Ç—Ä–æ–∫–∞
```

#### –ú–µ—Å—Ç–æ 2: –¢–∞–±–ª–∏—Ü–∞ `characteristic_value` + `product_characteristic_value`
```sql
characteristic_value.id = 11, value = '–ú—É–∂—Å–∫–æ–π', slug = 'male'
characteristic_value.id = 12, value = '–ñ–µ–Ω—Å–∫–∏–π', slug = 'female'
characteristic_value.id = 13, value = '–£–Ω–∏—Å–µ–∫—Å', slug = 'unisex'

product_characteristic_value:
  product_id | characteristic_id | characteristic_value_id
```

**–ü—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∏:**
```php
// FilterBuilder.php —Å—Ç—Ä–æ–∫–∞ 310
$isProductField = in_array($characteristic['key'], 
    ['gender', 'season', 'material', 'height', 'fastening', 'country']
);

if ($isProductField) {
    // –õ–æ–≥–∏–∫–∞ –¥–ª—è product.gender (—Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
    $filterData = self::buildProductFieldFilter(...);
} else {
    // –õ–æ–≥–∏–∫–∞ –¥–ª—è characteristic_value (—á–∏—Å–ª–æ–≤—ã–µ ID)
    $filterData = [...];
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤:**
   - `product.gender = 'male'` (—Å—Ç—Ä–æ–∫–∞, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
   - `characteristic_value.value = '–ú—É–∂—Å–∫–æ–π'` (—Å—Ç—Ä–æ–∫–∞, —Ä—É—Å—Å–∫–∏–π)
   - `characteristic_value.id = 11` (—á–∏—Å–ª–æ)

2. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∏ 617-636):
```php
// –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏–π - —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ —á–∏—Å–ª–∞
$firstValue = reset($value);
$isNumericId = is_numeric($firstValue);

if ($isNumericId) {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º ID ‚Üí slug ‚Üí product.gender
    $charValues = CharacteristicValue::find()
        ->select(['slug'])
        ->where(['id' => $value])
        ->column();
    $query->andWhere(['product.' . $characteristic->key => $charValues]);
} else {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–ø—Ä—è–º—É—é
    $query->andWhere(['product.' . $characteristic->key => $value]);
}
```

3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   - –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å 2 –º–µ—Å—Ç–∞
   - –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- ‚ùå –†–∏—Å–∫ –±–∞–≥–æ–≤ (–µ—Å–ª–∏ –∑–∞–±—ã—Ç—å –ø—Ä–æ –º–∞–ø–ø–∏–Ω–≥)
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ID ‚Üí slug)

**–†–µ—à–µ–Ω–∏–µ:**
```
–í–∞—Ä–∏–∞–Ω—Ç –ê: –£–±—Ä–∞—Ç—å –ø–æ–ª—è –∏–∑ product, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ characteristic_value
  + –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
  + –ì–∏–±–∫–æ—Å—Ç—å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π)
  - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (JOIN —Å product_characteristic_value)

–í–∞—Ä–∏–∞–Ω—Ç –ë: –£–±—Ä–∞—Ç—å characteristic_value –¥–ª—è —ç—Ç–∏—Ö –ø–æ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ product
  + –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç JOIN)
  + –ü—Ä–æ—â–µ –∫–æ–¥
  - –ú–µ–Ω–µ–µ –≥–∏–±–∫–æ (–Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)

–í–∞—Ä–∏–∞–Ω—Ç –í: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã/—Å–æ–±—ã—Ç–∏—è
  + –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞
  - –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
```

---

### 3. **–°–¢–ê–†–ê–Ø –¢–ê–ë–õ–ò–¶–ê `product_characteristic`** (–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

```php
// models/Product.php —Å—Ç—Ä–æ–∫–∞ 362-367
/**
 * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–∞ (—Å—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ product_characteristic)
 */
public function getCharacteristics()
{
    return $this->hasMany(ProductCharacteristic::class, ['product_id' => 'id'])
        ->orderBy(['sort_order' => SORT_ASC]);
}
```

**–ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ProductCharacteristic:
grep -r "ProductCharacteristic" --include="*.php" | grep -v "ProductCharacteristicValue"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–µ–ª–∏ Product, –Ω–∏–≥–¥–µ –±–æ–ª—å—à–µ
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥ (—Å–≤—è–∑—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- ‚ùå –ü—É—Ç–∞–Ω–∏—Ü–∞ (–µ—Å—Ç—å 2 —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫)
- ‚ùå –†–∏—Å–∫ –æ—à–∏–±–æ–∫ (–º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ `product_characteristic`
2. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Üí —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏ –º–æ–¥–µ–ª—å
3. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `product_characteristic_value`
4. –£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å `getCharacteristics()` –∏–∑ –º–æ–¥–µ–ª–∏ Product

---

### 4. **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –õ–û–ì–ò–ö–ò –ê–ö–¢–ò–í–ù–´–• –§–ò–õ–¨–¢–†–û–í** (–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ 3 –º–µ—Å—Ç–∞—Ö:

#### –ú–µ—Å—Ç–æ 1: `SmartFilter::formatActiveFilters()` (—Å—Ç—Ä–æ–∫–∏ 244-331)
```php
public static function formatActiveFilters($filters)
{
    $active = [];
    // –ë—Ä–µ–Ω–¥—ã
    if (!empty($filters['brands'])) { ... }
    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    if (!empty($filters['categories'])) { ... }
    // –¶–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä—ã, —Ü–≤–µ—Ç–∞
    ...
}
```

#### –ú–µ—Å—Ç–æ 2: `CatalogController::getActiveFilters()` (—Å—Ç—Ä–æ–∫–∏ 530-698)
```php
protected function getActiveFilters($currentFilters)
{
    $active = [];
    // –ë—Ä–µ–Ω–¥—ã
    if (!empty($currentFilters['brands'])) { ... }
    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    if (!empty($currentFilters['categories'])) { ... }
    // –¶–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä—ã, —Ü–≤–µ—Ç–∞
    // + –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (char_*)
    ...
}
```

#### –ú–µ—Å—Ç–æ 3: `web/js/catalog.js` (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞)
```javascript
function updateActiveFilters() {
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ JavaScript
}
```

**–†–∞–∑–ª–∏—á–∏—è:**
- `SmartFilter` ‚Üí –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (char_*)
- `CatalogController` ‚Üí –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –í–°–ï —Ñ–∏–ª—å—Ç—Ä—ã –≤–∫–ª—é—á–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- `catalog.js` ‚Üí –î—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å 3 –º–µ—Å—Ç–∞
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (SmartFilter –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö)
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```php
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ FilterBuilder
class FilterBuilder {
    public static function formatActiveFilters($filters) {
        // –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –í–°–ï–• —Ñ–∏–ª—å—Ç—Ä–æ–≤
    }
}

// –£–¥–∞–ª–∏—Ç—å –∏–∑ SmartFilter –∏ CatalogController
```

---

### 5. **–ò–ó–ë–´–¢–û–ß–ù–´–ï –ú–ï–¢–û–î–´ –í CatalogController** (–ö–æ–¥-–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥—ã `buildFilterUrl()` –∏ `SmartFilter::generateSefUrl()` –¥–µ–ª–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ:

#### –ú–µ—Ç–æ–¥ 1: `CatalogController::buildFilterUrl()` (—Å—Ç—Ä–æ–∫–∏ 703-726)
```php
protected function buildFilterUrl($filters)
{
    $params = [];
    if (!empty($filters['brands'])) $params['brands'] = implode(',', $filters['brands']);
    if (!empty($filters['categories'])) $params['categories'] = implode(',', $filters['categories']);
    // ... –∏ —Ç.–¥.
    return '/catalog' . (empty($params) ? '' : '?' . http_build_query($params));
}
```

#### –ú–µ—Ç–æ–¥ 2: `SmartFilter::generateSefUrl()` (—Å—Ç—Ä–æ–∫–∏ 22-87)
```php
public static function generateSefUrl($filters)
{
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SEF URL: /catalog/filter/nike-adidas/price-100-500/
}
```

**–†–∞–∑–ª–∏—á–∏—è:**
- `buildFilterUrl()` ‚Üí Query string: `/catalog?brands=1,2&price_from=100`
- `generateSefUrl()` ‚Üí SEF URL: `/catalog/filter/brand-nike-adidas/price-100-500/`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –î–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞ URL –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏
- ‚ùå –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –∫–∞–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–±–æ—Ä–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –í—ã–±—Ä–∞—Ç—å –û–î–ò–ù —Ñ–æ—Ä–º–∞—Ç URL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è SEF)
2. –£–¥–∞–ª–∏—Ç—å buildFilterUrl() –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
3. –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SmartFilter::generateSefUrl()
```

---

## üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 6. **–ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ô –ú–ï–¢–û–î `actionFilterSef()`** (–ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `CatalogController` –µ—Å—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è SEF URL, –Ω–æ –æ–Ω –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Ä–æ—É—Ç–∏–Ω–≥—É:

```php
// CatalogController.php —Å—Ç—Ä–æ–∫–∞ 1248
public function actionFilterSef($filters = '')
{
    $parsedFilters = SmartFilter::parseSefUrl($filters);
    // ... –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
}
```

**–ê–Ω–∞–ª–∏–∑:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞
grep -r "actionFilterSef" config/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–ï–¢ –ø—Ä–∞–≤–∏–ª —Ä–æ—É—Ç–∏–Ω–≥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—à–µ–Ω–∞
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚ùå SmartFilter —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ URL –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç query string –≤–º–µ—Å—Ç–æ SEF URL

**–†–µ—à–µ–Ω–∏–µ:**
```php
// config/web.php
'urlManager' => [
    'rules' => [
        'catalog/filter/<filters:.+>' => 'catalog/filter-sef',
    ],
],
```

---

### 7. **–ò–ó–ë–´–¢–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –¢–ò–ü–ê –ó–ù–ê–ß–ï–ù–ò–Ø** (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–Ω–∞—á–µ–Ω–∏—è:

```php
// FilterBuilder.php —Å—Ç—Ä–æ–∫–∏ 619-636
$firstValue = reset($value);
$isNumericId = is_numeric($firstValue);

if ($isNumericId) {
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ID ‚Üí slug
    $charValues = CharacteristicValue::find()
        ->select(['slug'])
        ->where(['id' => $value])
        ->column();
    $query->andWhere(['product.' . $characteristic->key => $charValues]);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `is_numeric()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- ‚ùå N+1 –ø—Ä–æ–±–ª–µ–º–∞ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫)

**–†–µ—à–µ–Ω–∏–µ:**
```php
// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
$characteristic->storage_type = 'product_field'; // –∏–ª–∏ 'characteristic_value'

// –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π
if ($characteristic->storage_type === 'product_field') {
    // –ü—Ä—è–º–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
}
```

---

### 8. **–ù–ï–û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –§–ò–õ–¨–¢–†–û–í** (UX –ø—Ä–æ–±–ª–µ–º–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–∏–ø–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–º—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º:

```php
// FilterBuilder.php —Å—Ç—Ä–æ–∫–∞ 37-63
return [
    'brands' => ...,           // 1. –ë—Ä–µ–Ω–¥—ã
    'categories' => ...,       // 2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    'priceRange' => ...,       // 3. –¶–µ–Ω–∞
    'sizes' => ...,            // 4. –†–∞–∑–º–µ—Ä—ã (4 —Å–∏—Å—Ç–µ–º—ã: EU/US/UK/CM)
    'discount' => ...,         // 5. –°–∫–∏–¥–∫–∏
    'rating' => ...,           // 6. –†–µ–π—Ç–∏–Ω–≥
    'conditions' => ...,       // 7. –£—Å–ª–æ–≤–∏—è (new, hit, in_stock)
    'characteristics' => ...,  // 8. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (gender, season, material, etc.)
    'colors' => ...,           // 9. –¶–≤–µ—Ç–∞
];
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå `conditions` ‚Üí `in_stock` –¥—É–±–ª–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `stock_status`
- ‚ùå `conditions` ‚Üí `new` –∏ `hit` ‚Äî —ç—Ç–æ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—ã, –∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- ‚ùå `discount` ‚Äî —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä, —Ö–æ—Ç—è –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º

**–†–µ—à–µ–Ω–∏–µ:**
```
1. –£–±—Ä–∞—Ç—å 'in_stock' –∏–∑ conditions (—ç—Ç–æ –±–∞–∑–æ–≤–æ–µ —É—Å–ª–æ–≤–∏–µ)
2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å 'new' –∏ 'hit' –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
3. –°–¥–µ–ª–∞—Ç—å discount –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏–∑ –ë–î)
```

---

## üü¢ –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 9. **–ñ–ï–°–¢–ö–û –ó–ê–ö–û–î–ò–†–û–í–ê–ù–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø** (Maintainability)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–Ω–∞—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ:

```php
// FilterBuilder.php —Å—Ç—Ä–æ–∫–∏ 411-444
protected static function getProductFieldLabels(string $fieldName): array
{
    $labels = [
        'gender' => [
            'male' => '–ú—É–∂—Å–∫–æ–π',
            'female' => '–ñ–µ–Ω—Å–∫–∏–π',
            'unisex' => '–£–Ω–∏—Å–µ–∫—Å',
        ],
        'season' => [
            'summer' => '–õ–µ—Ç–æ',
            'winter' => '–ó–∏–º–∞',
            // ...
        ],
        // ...
    ];
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (i18n)
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤ –º–æ–¥–µ–ª–∏ Product

**–†–µ—à–µ–Ω–∏–µ:**
```php
// –•—Ä–∞–Ω–∏—Ç—å –≤ –ë–î –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ
'components' => [
    'filterLabels' => [
        'class' => 'app\components\FilterLabels',
        'labels' => require(__DIR__ . '/filter_labels.php'),
    ],
],
```

---

### 10. **–û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–í** (SOLID –Ω–∞—Ä—É—à–µ–Ω–∏–µ)

**–ü—Ä–æ–±–ª–µ–º–∞:** `FilterBuilder` ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```php
class FilterBuilder
{
    public static function buildFilters(...) { }
    public static function applyFiltersToProductQuery(...) { }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ Dependency Inversion Principle
- ‚ùå –°–ª–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
```php
interface FilterBuilderInterface {
    public function buildFilters(array $currentFilters, array $baseConditions): array;
    public function applyFiltersToQuery($query, array $filters): void;
}

class FilterBuilder implements FilterBuilderInterface {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ —á–µ—Ä–µ–∑ DI
public function __construct(FilterBuilderInterface $filterBuilder) {
    $this->filterBuilder = $filterBuilder;
}
```

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –§–∞–π–ª—ã | –†–µ—à–µ–Ω–∏–µ |
|---|----------|-------------|-------|---------|
| 1 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | SmartFilter.php, FilterBuilder.php, CatalogController.php | –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å |
| 2 | –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | FilterBuilder.php (—Å—Ç—Ä–æ–∫–∏ 310-404, 617-636) | –í—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥ |
| 3 | –°—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ product_characteristic | üü° –°—Ä–µ–¥–Ω—è—è | Product.php, ProductCharacteristic.php | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å |
| 4 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ formatActiveFilters | üü° –°—Ä–µ–¥–Ω—è—è | SmartFilter.php, CatalogController.php, catalog.js | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å |
| 5 | –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã URL | üü° –°—Ä–µ–¥–Ω—è—è | CatalogController.php (703-726) | –£–¥–∞–ª–∏—Ç—å buildFilterUrl |
| 6 | –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π actionFilterSef | üü° –°—Ä–µ–¥–Ω—è—è | CatalogController.php (1248) | –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å |
| 7 | –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ | üü° –°—Ä–µ–¥–Ω—è—è | FilterBuilder.php (619-636) | –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ |
| 8 | –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ | üü° –°—Ä–µ–¥–Ω—è—è | FilterBuilder.php (37-63) | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| 9 | –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è | üü¢ –ú–µ–ª–∫–∞—è | FilterBuilder.php (411-444) | –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥ |
| 10 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ | üü¢ –ú–µ–ª–∫–∞—è | FilterBuilder.php | –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (#2)
2. ‚úÖ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (#1)
3. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É product_characteristic (#3)

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)
4. ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å formatActiveFilters (#4)
5. ‚úÖ –£–¥–∞–ª–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã URL (#5)
6. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–∞ (#7)

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏—è (–ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
7. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ (#8)
8. ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—å SEF URL —Ä–æ—É—Ç–∏–Ω–≥ (#6)
9. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ labels –≤ –∫–æ–Ω—Ñ–∏–≥ (#9)
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (#10)

---

## üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

### –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
services/
  Catalog/
    FilterService.php          ‚Üê –ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      - buildFilters()         ‚Üê –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
      - applyFilters()         ‚Üê –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å—É
      - formatActiveFilters()  ‚Üê –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö
      - generateUrl()          ‚Üê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è URL (SEF –∏–ª–∏ query)
      - parseUrl()             ‚Üê –ü–∞—Ä—Å–∏–Ω–≥ URL
    
    FilterConfig.php           ‚Üê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
      - getLabels()
      - getValidValues()
      - getStorageType()

models/
  Product.php                  ‚Üê –£–±—Ä–∞—Ç—å –ø–æ–ª—è gender, season, material
  Characteristic.php           ‚Üê –î–æ–±–∞–≤–∏—Ç—å storage_type
  CharacteristicValue.php      ‚Üê –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏–π

components/
  SmartFilter.php              ‚Üê –£–î–ê–õ–ò–¢–¨ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ FilterService)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** 6/10

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ MVC
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (FilterBuilder)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Eager loading –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
- ‚ùå –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- ‚ùå –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥ (—Å—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã)
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤ 3 —Ñ–∞–∑—ã, –Ω–∞—á–∏–Ω–∞—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º.
