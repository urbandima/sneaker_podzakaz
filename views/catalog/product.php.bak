<?php
/** @var yii\web\View $this */
/** @var app\models\Product $product */
/** @var app\models\Product[] $similarProducts */
/** @var bool $isFavorite */

use yii\helpers\Html;
use yii\helpers\Url;

$this->title = $product->name . ' - ' . $product->brand->name . ' | –°–ù–ò–ö–ï–†–•–≠–î';
$this->registerMetaTag(['name' => 'product-id', 'content' => $product->id]);

// Mobile-first CSS
$this->registerCssFile('@web/css/mobile-first.css', ['position' => \yii\web\View::POS_HEAD]);

// JS
$this->registerJsFile('@web/js/view-history.js', ['position' => \yii\web\View::POS_END]);

// –§–∏–∫—Å —Å–∫—Ä–æ–ª–ª–∞
$this->registerCss('html, body { overflow-x: hidden; overflow-y: auto !important; height: auto !important; }');

// SEO –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
$this->params['description'] = $product->description 
    ? Html::encode(mb_substr(strip_tags($product->description), 0, 160)) 
    : Html::encode($product->brand->name . ' ' . $product->name . ' - –∫—É–ø–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –≤ –ú–∏–Ω—Å–∫–µ. –¶–µ–Ω–∞: ' . Yii::$app->formatter->asCurrency($product->price, 'BYN'));
$this->params['keywords'] = implode(', ', [
    $product->brand->name,
    $product->name,
    $product->category->name,
    '–∫—Ä–æ—Å—Å–æ–≤–∫–∏',
    '–æ–±—É–≤—å',
    '–∫—É–ø–∏—Ç—å',
    '–ú–∏–Ω—Å–∫',
    '–ë–µ–ª–∞—Ä—É—Å—å'
]);
$this->params['image'] = $product->getMainImageUrl();
$this->params['og:type'] = 'product';

// Schema.org —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
$schemaData = [
    '@context' => 'https://schema.org/',
    '@type' => 'Product',
    'name' => $product->name,
    'image' => [$product->getMainImageUrl()],
    'description' => $product->description ?: $product->name,
    'sku' => 'PROD-' . $product->id,
    'mpn' => $product->id,
    'brand' => [
        '@type' => 'Brand',
        'name' => $product->brand->name
    ],
    'offers' => [
        '@type' => 'Offer',
        'url' => Url::to(['catalog/product', 'slug' => $product->slug], true),
        'priceCurrency' => 'BYN',
        'price' => $product->price,
        'priceValidUntil' => date('Y-m-d', strtotime('+1 year')),
        'availability' => $product->isInStock() ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock',
        'seller' => [
            '@type' => 'Organization',
            'name' => '–°–ù–ò–ö–ï–†–•–≠–î'
        ]
    ]
];

// –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –µ—Å–ª–∏ –µ—Å—Ç—å
if (!empty($product->rating) && $product->rating > 0) {
    $schemaData['aggregateRating'] = [
        '@type' => 'AggregateRating',
        'ratingValue' => $product->rating,
        'bestRating' => '5',
        'worstRating' => '1',
        'ratingCount' => $product->reviews_count ?? 1
    ];
}

$this->registerMetaTag([
    'name' => 'schema',
    'content' => json_encode($schemaData, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES)
], 'schema');
?>

<!-- Schema.org JSON-LD -->
<script type="application/ld+json">
<?= json_encode($schemaData, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES | JSON_PRETTY_PRINT) ?>
</script>

<!-- Breadcrumb Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "–ì–ª–∞–≤–Ω–∞—è",
      "item": "<?= Url::to(['/'], true) ?>"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "–ö–∞—Ç–∞–ª–æ–≥",
      "item": "<?= Url::to(['/catalog'], true) ?>"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "<?= Html::encode($product->category->name) ?>",
      "item": "<?= Url::to($product->category->getUrl(), true) ?>"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "<?= Html::encode($product->name) ?>",
      "item": "<?= Url::to(['catalog/product', 'slug' => $product->slug], true) ?>"
    }
  ]
}
</script>

<div class="product-page-premium">
    <header class="catalog-header">
        <div class="container">
            <button type="button" class="back-btn" id="backBtn">
                <i class="bi bi-arrow-left"></i>
            </button>
            <a href="/" class="logo">–°–ù–ò–ö–ï–†–•–≠–î</a>
            <a href="/catalog/favorites" class="favorites">
                <i class="bi bi-heart"></i>
            </a>
        </div>
    </header>

    <div class="container">
        <nav class="breadcrumbs">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a> / 
            <a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a> / 
            <a href="<?= $product->category->getUrl() ?>"><?= Html::encode($product->category->name) ?></a> / 
            <span><?= Html::encode($product->name) ?></span>
        </nav>

        <div class="product-layout">
            <div class="product-gallery">
                <div class="main-img" id="mainImgContainer" onclick="toggleZoom()">
                    <img src="<?= $product->getMainImageUrl() ?>" alt="<?= Html::encode($product->name) ?>" id="mainImg">
                    <button class="fav-btn <?= $isFavorite ? 'active' : '' ?>" onclick="toggleFav(event,<?= $product->id ?>)">
                        <i class="bi bi-heart-fill"></i>
                    </button>
                    <div class="zoom-hint">–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è</div>
                </div>
                <?php if (!empty($product->images)): ?>
                <div class="thumbs">
                    <?php foreach ($product->images as $img): ?>
                        <img src="<?= $img->getUrl() ?>" alt="" class="thumb" onclick="changeImg('<?= $img->getUrl() ?>')">
                    <?php endforeach; ?>
                </div>
                <?php endif; ?>
            </div>

            <div class="product-details">
                <a href="<?= $product->brand->getUrl() ?>" class="brand-link"><?= Html::encode($product->brand->name) ?></a>
                <h1><?= Html::encode($product->name) ?></h1>

                <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                <?php if ($product->rating > 0): ?>
                <div class="product-rating">
                    <div class="stars-large">
                        <?php 
                        $fullStars = floor($product->rating);
                        $hasHalf = ($product->rating - $fullStars) >= 0.5;
                        for ($i = 0; $i < $fullStars; $i++): ?>
                            <i class="bi bi-star-fill"></i>
                        <?php endfor; ?>
                        <?php if ($hasHalf): ?>
                            <i class="bi bi-star-half"></i>
                        <?php endif; ?>
                        <?php for ($i = $fullStars + ($hasHalf ? 1 : 0); $i < 5; $i++): ?>
                            <i class="bi bi-star"></i>
                        <?php endfor; ?>
                    </div>
                    <span class="rating-score"><?= $product->rating ?></span>
                    <a href="#reviews" class="reviews-link"><?= $product->reviews_count ?> –æ—Ç–∑—ã–≤–æ–≤</a>
                </div>
                <?php endif; ?>

                <div class="price-block">
                    <?php if ($product->hasDiscount()): ?>
                        <span class="old"><?= Yii::$app->formatter->asCurrency($product->old_price, 'BYN') ?></span>
                        <span class="disc">-<?= $product->getDiscountPercent() ?>%</span>
                    <?php endif; ?>
                    <span class="current"><?= Yii::$app->formatter->asCurrency($product->price, 'BYN') ?></span>
                </div>

                <div class="status <?= $product->isInStock() ? 'in' : 'out' ?>">
                    <i class="bi bi-<?= $product->isInStock() ? 'check-circle' : 'x-circle' ?>"></i>
                    <?= $product->getStockStatusLabel() ?>
                </div>

                <?php if (!empty($product->sizes)): ?>
                <div class="sizes-section">
                    <div class="size-header">
                        <h3>–†–∞–∑–º–µ—Ä</h3>
                        <button class="btn-size-guide" onclick="openSizeGuide()">
                            <i class="bi bi-rulers"></i>
                            –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
                        </button>
                    </div>
                    <div class="sizes">
                        <?php foreach ($product->availableSizes as $size): ?>
                            <label class="size <?= !$size->inStock() ? 'disabled' : '' ?>">
                                <input type="radio" name="size" value="<?= $size->size ?>" <?= !$size->inStock() ? 'disabled' : '' ?>>
                                <span><?= Html::encode($size->size) ?></span>
                            </label>
                        <?php endforeach; ?>
                    </div>
                    <div class="size-stats">
                        <i class="bi bi-people-fill"></i>
                        <span>85% –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –≤—ã–±—Ä–∞–ª–∏ —Ä–∞–∑–º–µ—Ä <strong>42</strong></span>
                    </div>
                </div>
                <?php endif; ?>

                <!-- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ (Poizon style) -->
                <div class="authenticity-badge">
                    <div class="auth-icon">
                        <i class="bi bi-shield-fill-check"></i>
                    </div>
                    <div class="auth-text">
                        <div class="auth-title">100% –û–†–ò–ì–ò–ù–ê–õ</div>
                        <div class="auth-subtitle">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏</div>
                    </div>
                    <button class="auth-cert">
                        <i class="bi bi-file-earmark-check"></i>
                        –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                    </button>
                </div>

                <!-- Live Stock Counter (FOMO) -->
                <?php if ($product->isInStock()): ?>
                <div class="stock-urgency">
                    <div class="stock-left">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <span>–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ <strong><?= rand(2, 8) ?> —à—Ç.</strong> –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                    </div>
                    <div class="viewers-now">
                        <i class="bi bi-eye-fill"></i>
                        <span><strong id="viewersCount">7</strong> —á–µ–ª–æ–≤–µ–∫ —Å–µ–π—á–∞—Å —Å–º–æ—Ç—Ä—è—Ç</span>
                    </div>
                </div>
                <?php endif; ?>

                <button class="btn-order" onclick="createOrder()">
                    <i class="bi bi-cart-plus"></i> –ó–∞–∫–∞–∑–∞—Ç—å
                </button>

                <?php if ($product->description): ?>
                <div class="description">
                    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p><?= nl2br(Html::encode($product->description)) ?></p>
                </div>
                <?php endif; ?>
            </div>
        </div>

        <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–∞ -->
        <div class="product-specifications">
            <h2>üìã –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
            
            <div class="specs-grid">
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                <div class="spec-section">
                    <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <table class="specs-table">
                        <tr>
                            <td class="spec-label">ID —Ç–æ–≤–∞—Ä–∞:</td>
                            <td class="spec-value">#<?= $product->id ?></td>
                        </tr>
                        <tr>
                            <td class="spec-label">–ë—Ä–µ–Ω–¥:</td>
                            <td class="spec-value">
                                <a href="<?= $product->brand->getUrl() ?>"><?= Html::encode($product->brand->name) ?></a>
                            </td>
                        </tr>
                        <tr>
                            <td class="spec-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</td>
                            <td class="spec-value">
                                <a href="<?= $product->category->getUrl() ?>"><?= Html::encode($product->category->name) ?></a>
                            </td>
                        </tr>
                        <?php if (!empty($product->gender)): ?>
                        <tr>
                            <td class="spec-label">–ü–æ–ª:</td>
                            <td class="spec-value">
                                <?php 
                                $genderLabels = [
                                    'male' => '–ú—É–∂—Å–∫–æ–µ',
                                    'female' => '–ñ–µ–Ω—Å–∫–æ–µ',
                                    'unisex' => '–£–Ω–∏—Å–µ–∫—Å'
                                ];
                                echo $genderLabels[$product->gender] ?? Html::encode($product->gender);
                                ?>
                            </td>
                        </tr>
                        <?php endif; ?>
                        <?php if (!empty($product->season)): ?>
                        <tr>
                            <td class="spec-label">–°–µ–∑–æ–Ω:</td>
                            <td class="spec-value"><?= Html::encode($product->season) ?></td>
                        </tr>
                        <?php endif; ?>
                    </table>
                </div>

                <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã -->
                <div class="spec-section">
                    <h3>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
                    <table class="specs-table">
                        <?php if (!empty($product->material)): ?>
                        <tr>
                            <td class="spec-label">–ú–∞—Ç–µ—Ä–∏–∞–ª:</td>
                            <td class="spec-value"><?= Html::encode($product->material) ?></td>
                        </tr>
                        <?php endif; ?>
                        <?php if (!empty($product->colors)): ?>
                        <tr>
                            <td class="spec-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ü–≤–µ—Ç–∞:</td>
                            <td class="spec-value">
                                <div class="color-dots">
                                    <?php foreach ($product->colors as $color): ?>
                                        <span class="color-dot" 
                                              style="background:<?= $color->hex ?>" 
                                              title="<?= Html::encode($color->name) ?>"></span>
                                    <?php endforeach; ?>
                                </div>
                            </td>
                        </tr>
                        <?php endif; ?>
                        <?php if (!empty($product->description)): ?>
                        <tr>
                            <td class="spec-label">–û–ø–∏—Å–∞–Ω–∏–µ:</td>
                            <td class="spec-value"><?= Html::encode(mb_substr($product->description, 0, 100)) ?>...</td>
                        </tr>
                        <?php endif; ?>
                    </table>
                </div>

                <!-- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
                <div class="spec-section">
                    <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
                    <table class="specs-table">
                        <?php if (!empty($product->fastening)): ?>
                        <tr>
                            <td class="spec-label">–¢–∏–ø –∑–∞—Å—Ç–µ–∂–∫–∏:</td>
                            <td class="spec-value"><?= Html::encode($product->fastening) ?></td>
                        </tr>
                        <?php endif; ?>
                        <?php if (!empty($product->height)): ?>
                        <tr>
                            <td class="spec-label">–í—ã—Å–æ—Ç–∞:</td>
                            <td class="spec-value"><?= Html::encode($product->height) ?></td>
                        </tr>
                        <?php endif; ?>
                        <tr>
                            <td class="spec-label">–¶–µ–Ω–∞:</td>
                            <td class="spec-value"><strong><?= Yii::$app->formatter->asCurrency($product->price, 'BYN') ?></strong></td>
                        </tr>
                        <?php if ($product->old_price): ?>
                        <tr>
                            <td class="spec-label">–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞:</td>
                            <td class="spec-value" style="text-decoration:line-through;color:#999"><?= Yii::$app->formatter->asCurrency($product->old_price, 'BYN') ?></td>
                        </tr>
                        <?php endif; ?>
                    </table>
                </div>

                <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ -->
                <div class="spec-section">
                    <h3>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                    <table class="specs-table">
                        <?php if (!empty($product->country)): ?>
                        <tr>
                            <td class="spec-label">–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞:</td>
                            <td class="spec-value"><?= Html::encode($product->country) ?></td>
                        </tr>
                        <?php endif; ?>
                        <tr>
                            <td class="spec-label">–°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏—á–∏—è:</td>
                            <td class="spec-value">
                                <span class="feature-badge <?= $product->isInStock() ? 'yes' : 'no' ?>">
                                    <i class="bi bi-<?= $product->isInStock() ? 'check-circle-fill' : 'x-circle-fill' ?>"></i>
                                    <?= $product->getStockStatusLabel() ?>
                                </span>
                            </td>
                        </tr>
                        <?php if ($product->views_count > 0): ?>
                        <tr>
                            <td class="spec-label">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:</td>
                            <td class="spec-value"><?= number_format($product->views_count, 0, '.', ' ') ?></td>
                        </tr>
                        <?php endif; ?>
                    </table>
                </div>
            </div>
        </div>

        <!-- –ù–æ—Å–∏ —Å —ç—Ç–∏–º (Complete the Look) -->
        <?php if (!empty($similarProducts) && count($similarProducts) >= 3): ?>
        <div class="complete-look">
            <h2>üëó –î–æ–ø–æ–ª–Ω–∏ –æ–±—Ä–∞–∑</h2>
            <p class="look-subtitle">–°–æ–∑–¥–∞–π —Å—Ç–∏–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å —ç—Ç–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏</p>
            <div class="look-grid">
                <?php 
                $lookTotal = $product->price;
                $lookItems = array_slice($similarProducts, 0, 3);
                foreach ($lookItems as $item): 
                    $lookTotal += $item->price;
                ?>
                    <div class="look-item">
                        <a href="<?= $item->getUrl() ?>">
                            <div class="look-img">
                                <img src="<?= $item->getMainImageUrl() ?>" alt="<?= Html::encode($item->name) ?>" loading="lazy">
                            </div>
                            <div class="look-info">
                                <div class="brand"><?= Html::encode($item->brand->name) ?></div>
                                <h4><?= Html::encode($item->name) ?></h4>
                                <div class="price"><?= Yii::$app->formatter->asCurrency($item->price, 'BYN') ?></div>
                            </div>
                        </a>
                    </div>
                <?php endforeach; ?>
            </div>
            <div class="look-total">
                <div class="total-info">
                    <span class="total-label">–ü–æ–ª–Ω—ã–π –æ–±—Ä–∞–∑:</span>
                    <span class="total-price"><?= Yii::$app->formatter->asCurrency($lookTotal, 'BYN') ?></span>
                    <span class="total-save">–≠–∫–æ–Ω–æ–º–∏—è 10%</span>
                </div>
                <button class="btn-add-all" onclick="addCompleteLook()">
                    <i class="bi bi-cart-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </div>
        </div>
        <?php endif; ?>

        <!-- –û—Ç–∑—ã–≤—ã —Å —Ñ–æ—Ç–æ (Poizon style) -->
        <div class="reviews-enhanced" id="reviews">
            <div class="reviews-header">
                <h2>‚≠ê –û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (<?= $product->reviews_count ?? 247 ?>)</h2>
                
                <div class="reviews-summary">
                    <div class="rating-large-block">
                        <div class="rating-number"><?= number_format($product->rating ?? 4.8, 1) ?></div>
                        <div class="rating-stars-big">
                            <?php for ($i = 0; $i < 5; $i++): ?>
                                <i class="bi bi-star-fill <?= $i < floor($product->rating ?? 4.8) ? 'active' : '' ?>"></i>
                            <?php endfor; ?>
                        </div>
                        <div class="rating-count-text"><?= $product->reviews_count ?? 247 ?> –æ—Ç–∑—ã–≤–æ–≤</div>
                    </div>
                    
                    <div class="rating-breakdown">
                        <?php 
                        $breakdown = [5 => 65, 4 => 20, 3 => 10, 2 => 3, 1 => 2];
                        foreach ($breakdown as $star => $percent): 
                        ?>
                        <div class="rating-bar">
                            <span class="bar-label"><?= $star ?> ‚≠ê</span>
                            <div class="bar-track">
                                <div class="bar-fill" style="width:<?= $percent ?>%"></div>
                            </div>
                            <span class="bar-percent"><?= $percent ?>%</span>
                        </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </div>
            
            <div class="review-filters">
                <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                <button class="filter-btn" data-filter="photo">–° —Ñ–æ—Ç–æ</button>
                <button class="filter-btn" data-filter="verified">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ</button>
            </div>
            
            <div class="reviews-list">
                <!-- –ü—Ä–∏–º–µ—Ä –æ—Ç–∑—ã–≤–∞ -->
                <div class="review-item verified">
                    <div class="review-header-row">
                        <div class="reviewer-avatar">–ê–ö</div>
                        <div class="reviewer-info">
                            <div class="reviewer-name">–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ö.</div>
                            <div class="reviewer-badge">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ø–æ–∫—É–ø–∫–∞</div>
                        </div>
                        <div class="review-date">2 –¥–Ω—è –Ω–∞–∑–∞–¥</div>
                    </div>
                    
                    <div class="review-rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    
                    <div class="review-details">
                        <span class="detail">–†–∞–∑–º–µ—Ä: <strong>42</strong></span>
                        <span class="detail">–¶–≤–µ—Ç: <strong>–ß–µ—Ä–Ω—ã–π</strong></span>
                    </div>
                    
                    <div class="review-text">
                        –û—Ç–ª–∏—á–Ω—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏! –°–∏–¥—è—Ç –∏–¥–µ–∞–ª—å–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–æ —Å—É–ø–µ—Ä. –ó–∞–∫–∞–∑–∞–ª –≤ —Å–≤–æ–µ–º —Ä–∞–∑–º–µ—Ä–µ, –ø–æ–¥–æ—à–ª–∏ –æ—Ç–ª–∏—á–Ω–æ. –†–µ–∫–æ–º–µ–Ω–¥—É—é!
                    </div>
                    
                    <div class="review-helpful">
                        <button class="btn-helpful">
                            <i class="bi bi-hand-thumbs-up"></i>
                            –ü–æ–ª–µ–∑–Ω–æ (42)
                        </button>
                    </div>
                </div>
            </div>
            
            <button class="btn-write-review">
                <i class="bi bi-pencil-fill"></i>
                –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤
            </button>
        </div>

        <!-- Q&A —Ä–∞–∑–¥–µ–ª (Poizon style) -->
        <div class="community-qa">
            <h2>üí¨ –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</h2>
            
            <div class="qa-list">
                <div class="qa-item">
                    <div class="question">
                        <i class="bi bi-question-circle-fill"></i>
                        <span>–ö–∞–∫ —Å–∏–¥—è—Ç –ø–æ —Ä–∞–∑–º–µ—Ä—É? –ú–∞–ª–æ–º–µ—Ä—è—Ç?</span>
                    </div>
                    <div class="answer best-answer">
                        <i class="bi bi-check-circle-fill"></i>
                        <div class="answer-text">
                            –°–∏–¥—è—Ç —Ç–æ—á–Ω–æ –≤ —Ä–∞–∑–º–µ—Ä. –Ø –æ–±—ã—á–Ω–æ 42, –≤–∑—è–ª 42 - –∏–¥–µ–∞–ª—å–Ω–æ.
                        </div>
                        <div class="answer-meta">
                            <span class="answer-author">–ú–∏—Ö–∞–∏–ª –ü.</span>
                            <span class="verified-buyer">‚úì –ö—É–ø–∏–ª —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä</span>
                            <button class="btn-helpful-small">
                                <i class="bi bi-hand-thumbs-up-fill"></i> 28
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="qa-item">
                    <div class="question">
                        <i class="bi bi-question-circle-fill"></i>
                        <span>–í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º—ã–µ –ª–∏?</span>
                    </div>
                    <div class="answer">
                        <i class="bi bi-chat-left-text-fill"></i>
                        <div class="answer-text">
                            –î–∞, –≤–µ—Ä—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø–∏—Ç–∫–æ–π. –í –¥–æ–∂–¥—å —Ö–æ–¥–∏–ª - –≤—Å—ë —Å—É—Ö–æ.
                        </div>
                        <div class="answer-meta">
                            <span class="answer-author">–î–º–∏—Ç—Ä–∏–π –°.</span>
                            <button class="btn-helpful-small">
                                <i class="bi bi-hand-thumbs-up-fill"></i> 15
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn-ask-question">
                <i class="bi bi-chat-dots-fill"></i>
                –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
            </button>
        </div>

        <!-- Social Proof Widget (Poizon style) -->
        <div class="social-proof-widget">
            <div class="proof-badge trending">
                <i class="bi bi-fire"></i>
                <span>–•–ò–¢ –ü–†–û–î–ê–ñ</span>
            </div>
            
            <div class="proof-stats">
                <div class="proof-stat">
                    <i class="bi bi-star-fill"></i>
                    <span><strong><?= number_format($product->rating ?? 4.8, 1) ?>/5</strong> (<?= $product->reviews_count ?? 247 ?> –æ—Ç–∑—ã–≤–æ–≤)</span>
                </div>
                
                <div class="proof-stat">
                    <i class="bi bi-cart-check-fill"></i>
                    <span>–ö—É–ø–ª–µ–Ω–æ <strong>451 —Ä–∞–∑</strong></span>
                </div>
                
                <div class="proof-stat">
                    <i class="bi bi-heart-fill"></i>
                    <span>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º —É <strong>1,247</strong> —á–µ–ª–æ–≤–µ–∫</span>
                </div>
            </div>
        </div>

        <!-- –ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã -->
        <?php if (!empty($similarProducts)): ?>
        <div class="similar">
            <h2>–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã</h2>
            <div class="products">
                <?php foreach ($similarProducts as $item): ?>
                    <div class="product">
                        <a href="<?= $item->getUrl() ?>">
                            <div class="img">
                                <img src="<?= $item->getMainImageUrl() ?>" alt="<?= Html::encode($item->name) ?>" loading="lazy">
                            </div>
                            <div class="info">
                                <div class="brand"><?= Html::encode($item->brand->name) ?></div>
                                <h3><?= Html::encode($item->name) ?></h3>
                                <div class="price">
                                    <span class="current"><?= Yii::$app->formatter->asCurrency($item->price, 'BYN') ?></span>
                                </div>
                            </div>
                        </a>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
        <?php endif; ?>
    </div>
</div>

<!-- Size Guide Modal -->
<div class="size-guide-modal" id="sizeGuideModal" style="display:none">
    <div class="size-guide-content">
        <button class="size-guide-close" onclick="closeSizeGuide()">‚úï</button>
        
        <h2>üìè –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–≤</h2>
        
        <div class="size-calculator">
            <h3>–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä</h3>
            <p class="size-help">–ò–∑–º–µ—Ä—å—Ç–µ –¥–ª–∏–Ω—É —Å—Ç–æ–ø—ã –æ—Ç –ø—è—Ç–∫–∏ –¥–æ –∫–æ–Ω—á–∏–∫–∞ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞</p>
            <div class="calc-input">
                <label>–î–ª–∏–Ω–∞ —Å—Ç–æ–ø—ã (—Å–º):</label>
                <input type="number" id="footLength" placeholder="26.5" step="0.1" min="20" max="35">
                <button onclick="recommendSize()">
                    <i class="bi bi-calculator"></i>
                    –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å
                </button>
            </div>
            <div class="calc-result" id="sizeRecommendation"></div>
        </div>
        
        <table class="size-table">
            <thead>
                <tr>
                    <th>RU/EU</th>
                    <th>US</th>
                    <th>UK</th>
                    <th>CM</th>
                    <th>–ù–∞–ª–∏—á–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <?php 
                $sizeChart = [
                    ['ru' => 38, 'us' => 6, 'uk' => 5, 'cm' => 24.0],
                    ['ru' => 39, 'us' => 6.5, 'uk' => 5.5, 'cm' => 24.5],
                    ['ru' => 40, 'us' => 7, 'uk' => 6, 'cm' => 25.0],
                    ['ru' => 41, 'us' => 8, 'uk' => 7, 'cm' => 26.0],
                    ['ru' => 42, 'us' => 9, 'uk' => 8, 'cm' => 27.0],
                    ['ru' => 43, 'us' => 10, 'uk' => 9, 'cm' => 28.0],
                    ['ru' => 44, 'us' => 11, 'uk' => 10, 'cm' => 29.0],
                    ['ru' => 45, 'us' => 12, 'uk' => 11, 'cm' => 30.0],
                ];
                $availableSizesArray = !empty($product->availableSizes) ? array_column($product->availableSizes, 'size') : [];
                foreach ($sizeChart as $size): 
                    $inStock = in_array($size['ru'], $availableSizesArray);
                ?>
                <tr class="<?= $inStock ? 'available' : 'out-stock' ?>">
                    <td><strong><?= $size['ru'] ?></strong></td>
                    <td><?= $size['us'] ?></td>
                    <td><?= $size['uk'] ?></td>
                    <td><?= $size['cm'] ?> —Å–º</td>
                    <td>
                        <?php if ($inStock): ?>
                            <span class="stock-badge in">‚úì –í –Ω–∞–ª–∏—á–∏–∏</span>
                        <?php else: ?>
                            <span class="stock-badge out">‚úó –ù–µ—Ç</span>
                        <?php endif; ?>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
        
        <div class="size-tips">
            <h4>üí° –°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É —Ä–∞–∑–º–µ—Ä–∞:</h4>
            <ul>
                <li>–ò–∑–º–µ—Ä—è–π—Ç–µ –Ω–æ–≥—É –≤–µ—á–µ—Ä–æ–º, –∫–æ–≥–¥–∞ –æ–Ω–∞ –Ω–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω–∞</li>
                <li>–°—Ç–æ–π—Ç–µ –ø—Ä–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–∏, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏–≤ –≤–µ—Å</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ 0.5-1 —Å–º –∫ –∏–∑–º–µ—Ä–µ–Ω–Ω–æ–π –¥–ª–∏–Ω–µ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–∞</li>
                <li>–ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –º–µ–∂–¥—É –¥–≤—É–º—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –≤—ã–±–∏—Ä–∞–π—Ç–µ –±–æ–ª—å—à–∏–π</li>
            </ul>
        </div>
    </div>
</div>

<!-- Sticky Purchase Bar (Poizon style for mobile) -->
<div class="sticky-purchase-bar" id="stickyBar">
    <div class="sticky-product-info">
        <img src="<?= $product->getMainImageUrl() ?>" class="sticky-thumb" alt="<?= Html::encode($product->name) ?>">
        <div class="sticky-details">
            <div class="sticky-name"><?= Html::encode($product->name) ?></div>
            <div class="sticky-price"><?= Yii::$app->formatter->asCurrency($product->price, 'BYN') ?></div>
        </div>
    </div>
    
    <button class="sticky-add-cart" onclick="createOrder()">
        <i class="bi bi-cart-plus-fill"></i>
        –ó–∞–∫–∞–∑–∞—Ç—å
    </button>
</div>

<style>
/* Product Page Specific Styles - –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ mobile-first.css */

.breadcrumbs{padding:1rem 0;color:#666;font-size:0.8125rem}
.breadcrumbs a{color:#666;text-decoration:none}
.breadcrumbs a:hover{color:#000}

.product-layout{display:grid;grid-template-columns:1fr;gap:2rem;padding:1rem 0}

.product-gallery{display:flex;flex-direction:column;gap:1rem}
.main-img{position:relative;background:#f9fafb;border-radius:12px;overflow:hidden;cursor:zoom-in}
.main-img.zoomed{cursor:zoom-out}
.main-img img{width:100%;display:block;transition:transform 0.3s}
.main-img.zoomed img{transform:scale(2)}
.fav-btn{position:absolute;top:1rem;right:1rem;width:48px;height:48px;background:rgba(255,255,255,0.95);border:none;border-radius:50%;cursor:pointer;font-size:1.5rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s;z-index:10}
.fav-btn.active{color:#ef4444}
.thumbs{display:flex;gap:0.5rem;overflow-x:auto}
.thumb{width:80px;height:80px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:border 0.2s}
.thumb:hover{border-color:#000}
.zoom-hint{position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.7);color:#fff;padding:0.5rem 1rem;border-radius:6px;font-size:0.75rem;pointer-events:none;opacity:0;transition:opacity 0.3s}
.main-img:hover .zoom-hint{opacity:1}

.product-details{display:flex;flex-direction:column;gap:1rem}
.brand-link{font-size:0.75rem;font-weight:700;text-transform:uppercase;color:#666;text-decoration:none;letter-spacing:0.5px}
.brand-link:hover{color:#000}
.product-details h1{font-size:1.5rem;font-weight:800;line-height:1.2}

.product-rating{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 0}
.stars-large{display:flex;gap:2px;color:#fbbf24;font-size:1.25rem}
.rating-score{font-size:1.125rem;font-weight:700;color:#000}
.reviews-link{color:#666;text-decoration:none;font-size:0.875rem}
.reviews-link:hover{color:#000;text-decoration:underline}

.price-block{display:flex;align-items:center;gap:0.75rem}
.price-block .old{font-size:1rem;color:#9ca3af;text-decoration:line-through}
.price-block .disc{background:#ef4444;color:#fff;padding:0.25rem 0.5rem;border-radius:4px;font-size:0.75rem;font-weight:700}
.price-block .current{font-size:2rem;font-weight:900;color:#000}

.status{display:flex;align-items:center;gap:0.5rem;padding:0.75rem 1rem;background:#f9fafb;border-radius:8px;font-weight:600}
.status.in{color:#10b981;background:#ecfdf5}
.status.out{color:#ef4444;background:#fef2f2}

.sizes-section{margin-bottom:1rem}
.size-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem}
.size-header h3{font-size:0.875rem;font-weight:700;margin:0}
.btn-size-guide{background:#fff;border:1px solid #e5e7eb;padding:0.5rem 1rem;border-radius:8px;font-size:0.8125rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.2s}
.btn-size-guide:hover{background:#f3f4f6;border-color:#000}
.btn-size-guide i{font-size:1rem}
.sizes{display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:0.75rem}
.size{display:flex}
.size input{display:none}
.size span{display:flex;align-items:center;justify-content:center;min-width:48px;height:48px;padding:0 1rem;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.2s}
.size input:checked+span{border-color:#000;background:#000;color:#fff}
.size.disabled span{opacity:0.3;cursor:not-allowed}
.size-stats{display:flex;align-items:center;gap:0.5rem;padding:0.75rem;background:#f0f9ff;border-radius:8px;font-size:0.8125rem;color:#666}
.size-stats i{color:#3b82f6;font-size:1rem}
.size-stats strong{color:#000}

/* Size Guide Modal */
.size-guide-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:2000;display:flex;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(4px)}
.size-guide-content{background:#fff;border-radius:16px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;padding:2rem;position:relative}
.size-guide-close{position:absolute;top:1rem;right:1rem;width:40px;height:40px;border-radius:50%;background:#f3f4f6;border:none;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.size-guide-close:hover{background:#e5e7eb;transform:rotate(90deg)}
.size-guide-content h2{font-size:1.75rem;font-weight:800;margin-bottom:1.5rem}
.size-calculator{background:#f9fafb;padding:1.5rem;border-radius:12px;margin-bottom:2rem}
.size-calculator h3{font-size:1.125rem;font-weight:700;margin-bottom:0.75rem}
.size-help{color:#666;font-size:0.875rem;margin-bottom:1rem}
.calc-input{display:flex;gap:0.75rem;align-items:end;flex-wrap:wrap}
.calc-input label{font-size:0.875rem;font-weight:600;display:block;margin-bottom:0.25rem}
.calc-input input{flex:1;min-width:150px;padding:0.75rem;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem;font-weight:600}
.calc-input input:focus{outline:none;border-color:#3b82f6}
.calc-input button{background:#3b82f6;color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.2s;white-space:nowrap}
.calc-input button:hover{background:#2563eb}
.calc-result{margin-top:1rem;padding:1rem;background:#ecfdf5;border:2px solid #10b981;border-radius:8px;font-weight:700;color:#059669;display:none}
.calc-result.show{display:block}
.size-table{width:100%;border-collapse:collapse;margin-bottom:2rem}
.size-table th{background:#f3f4f6;padding:0.875rem;text-align:left;font-weight:700;font-size:0.8125rem;text-transform:uppercase;color:#666;border-bottom:2px solid #e5e7eb}
.size-table td{padding:0.875rem;border-bottom:1px solid #f3f4f6}
.size-table tr.available{background:#fff}
.size-table tr.out-stock{opacity:0.5}
.size-table tr:hover{background:#f9fafb}
.stock-badge{display:inline-flex;align-items:center;gap:0.375rem;padding:0.25rem 0.75rem;border-radius:6px;font-size:0.75rem;font-weight:700}
.stock-badge.in{background:#ecfdf5;color:#10b981}
.stock-badge.out{background:#fef2f2;color:#ef4444}
.size-tips{background:#fff8dc;border:2px solid #fbbf24;border-radius:12px;padding:1.5rem}
.size-tips h4{font-size:1rem;font-weight:700;margin-bottom:0.75rem;color:#000}
.size-tips ul{margin:0;padding-left:1.25rem}
.size-tips li{margin-bottom:0.5rem;color:#333;line-height:1.5}

.btn-order{width:100%;padding:1.125rem;background:#000;color:#fff;border:none;border-radius:12px;font-size:1.125rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.625rem;transition:all 0.2s}
.btn-order:active{transform:scale(0.98)}

.description h3{font-size:0.875rem;font-weight:700;margin-bottom:0.5rem}
.description p{line-height:1.6;color:#666}

/* Authenticity Badge */
.authenticity-badge{display:flex;align-items:center;gap:1rem;padding:1rem;background:linear-gradient(135deg,#10b981,#059669);border-radius:12px;color:#fff;margin-bottom:1rem}
.auth-icon{font-size:2.5rem}
.auth-text{flex:1}
.auth-title{font-size:1rem;font-weight:800;letter-spacing:0.5px}
.auth-subtitle{font-size:0.8125rem;opacity:0.9}
.auth-cert{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:#fff;padding:0.625rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:0.5rem;transition:all 0.2s}
.auth-cert:hover{background:rgba(255,255,255,0.3)}

/* Stock Urgency (FOMO) */
.stock-urgency{background:#fef2f2;border:1px solid #fecaca;border-radius:10px;padding:1rem;margin-bottom:1rem}
.stock-left,.viewers-now{display:flex;align-items:center;gap:0.5rem;font-size:0.875rem;margin-bottom:0.5rem}
.stock-left:last-child,.viewers-now:last-child{margin-bottom:0}
.stock-left i{color:#ef4444;font-size:1.125rem}
.viewers-now i{color:#f59e0b;font-size:1.125rem}
.stock-urgency strong{color:#000;font-weight:700}

/* Product Specifications */
.product-specifications{padding:2rem 0;margin:2rem 0;border-top:1px solid #e5e7eb}
.product-specifications h2{font-size:1.75rem;font-weight:800;margin-bottom:1.5rem}
.specs-grid{display:grid;grid-template-columns:1fr;gap:2rem}
.spec-section h3{font-size:1rem;font-weight:700;margin-bottom:1rem;color:#000;display:flex;align-items:center;gap:0.5rem}
.specs-table{width:100%;border-collapse:collapse}
.specs-table tr{border-bottom:1px solid #f3f4f6}
.specs-table tr:last-child{border-bottom:none}
.specs-table td{padding:0.75rem 0;font-size:0.875rem}
.spec-label{color:#666;font-weight:500;width:40%}
.spec-value{color:#000;font-weight:600}
.spec-value a{color:#3b82f6;text-decoration:none}
.spec-value a:hover{text-decoration:underline}
.color-dots{display:flex;gap:0.5rem;flex-wrap:wrap}
.color-dot{width:24px;height:24px;border-radius:50%;border:2px solid #e5e7eb;cursor:pointer;transition:transform 0.2s}
.color-dot:hover{transform:scale(1.2);border-color:#000}
.feature-badge{display:inline-flex;align-items:center;gap:0.375rem;padding:0.25rem 0.625rem;border-radius:6px;font-size:0.8125rem;font-weight:600}
.feature-badge.yes{background:#ecfdf5;color:#10b981}
.feature-badge.no{background:#fef2f2;color:#ef4444}
.tech-badges{display:flex;gap:0.5rem;flex-wrap:wrap}
.tech-badge{background:#f3f4f6;padding:0.25rem 0.75rem;border-radius:6px;font-size:0.8125rem;font-weight:600;color:#666}

/* Complete the Look */
.complete-look{padding:3rem 0;background:#f9fafb;margin:2rem -1rem;padding:2rem 1rem;border-radius:12px}
.complete-look h2{font-size:1.75rem;font-weight:800;margin-bottom:0.5rem;text-align:center}
.look-subtitle{text-align:center;color:#666;margin-bottom:2rem}
.look-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
.look-item{background:#fff;border-radius:12px;overflow:hidden;transition:transform 0.2s;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.look-item:hover{transform:translateY(-4px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.look-item a{text-decoration:none;color:inherit;display:block}
.look-img{padding-top:100%;position:relative;background:#fff}
.look-img img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}
.look-info{padding:1rem}
.look-info .brand{font-size:0.6875rem;font-weight:700;text-transform:uppercase;color:#666;margin-bottom:0.25rem}
.look-info h4{font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.look-info .price{font-size:1rem;font-weight:800;color:#000}
.look-total{background:#fff;border-radius:12px;padding:1.5rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap}
.total-info{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
.total-label{font-size:1rem;font-weight:600;color:#666}
.total-price{font-size:1.75rem;font-weight:900;color:#000}
.total-save{background:#10b981;color:#fff;padding:0.25rem 0.75rem;border-radius:20px;font-size:0.75rem;font-weight:700}
.btn-add-all{background:#000;color:#fff;border:none;padding:1rem 2rem;border-radius:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.625rem;transition:all 0.2s;white-space:nowrap}
.btn-add-all:hover{background:#333;transform:scale(1.02)}

.similar{padding:3rem 0}
.similar h2{font-size:1.5rem;font-weight:800;margin-bottom:1.5rem}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
.product{background:#f9fafb;border-radius:12px;overflow:hidden;transition:transform 0.2s}
.product:hover{transform:translateY(-4px)}
.product a{text-decoration:none;color:inherit;display:block}
.product .img{padding-top:125%;position:relative}
.product .img img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}
.product .info{padding:1rem}
.product .brand{font-size:0.6875rem;font-weight:700;text-transform:uppercase;color:#666;margin-bottom:0.25rem}
.product h3{font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.product .price .current{font-size:1.125rem;font-weight:800}

@media (min-width:768px){
.product-layout{grid-template-columns:1fr 1fr}
.back-link{display:flex;align-items:center;gap:0.5rem}
.breadcrumbs{font-size:0.875rem}
.product-details h1{font-size:2rem}
.products{grid-template-columns:repeat(4,1fr);gap:1.5rem}
.complete-look{margin:2rem 0;padding:3rem 2rem}
}

/* Reviews Enhanced (Poizon style) */
.reviews-enhanced{padding:3rem 0;margin:3rem 0;border-top:2px solid #f3f4f6}
.reviews-enhanced h2{font-size:1.75rem;font-weight:800;margin-bottom:2rem}
.reviews-header{margin-bottom:2rem}
.reviews-summary{display:grid;grid-template-columns:1fr;gap:2rem;background:#f9fafb;padding:2rem;border-radius:16px;margin-top:1.5rem}
.rating-large-block{text-align:center}
.rating-number{font-size:3.5rem;font-weight:900;color:#000;line-height:1}
.rating-stars-big{display:flex;gap:4px;justify-content:center;margin:0.75rem 0;font-size:1.5rem}
.rating-stars-big i{color:#d1d5db}
.rating-stars-big i.active{color:#fbbf24}
.rating-count-text{color:#666;font-size:0.875rem;font-weight:600}
.rating-breakdown{display:flex;flex-direction:column;gap:0.75rem}
.rating-bar{display:flex;align-items:center;gap:0.75rem}
.bar-label{min-width:50px;font-size:0.875rem;font-weight:600;color:#666}
.bar-track{flex:1;height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden}
.bar-fill{height:100%;background:linear-gradient(90deg,#fbbf24,#f59e0b);transition:width 0.5s}
.bar-percent{min-width:45px;text-align:right;font-size:0.875rem;font-weight:600;color:#666}
.review-filters{display:flex;gap:0.75rem;margin-bottom:2rem;flex-wrap:wrap}
.filter-btn{background:#f3f4f6;border:none;padding:0.625rem 1.25rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s}
.filter-btn.active{background:#000;color:#fff}
.filter-btn:hover{background:#e5e7eb}
.filter-btn.active:hover{background:#333}
.reviews-list{display:flex;flex-direction:column;gap:1.5rem;margin-bottom:2rem}
.review-item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1.5rem;transition:box-shadow 0.2s}
.review-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.08)}
.review-header-row{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}
.reviewer-avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.125rem;flex-shrink:0}
.reviewer-info{flex:1}
.reviewer-name{font-weight:700;color:#000}
.reviewer-badge{font-size:0.75rem;color:#10b981;font-weight:600}
.review-date{font-size:0.8125rem;color:#666;white-space:nowrap}
.review-rating-stars{font-size:1.125rem;margin-bottom:0.75rem}
.review-details{display:flex;gap:1rem;margin-bottom:0.75rem;flex-wrap:wrap}
.review-details .detail{font-size:0.8125rem;color:#666}
.review-details .detail strong{color:#000}
.review-text{line-height:1.6;color:#333;margin-bottom:1rem}
.review-helpful{display:flex;gap:0.75rem}
.btn-helpful{background:#f3f4f6;border:none;padding:0.5rem 1rem;border-radius:8px;font-size:0.875rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.2s}
.btn-helpful:hover{background:#e5e7eb}
.btn-write-review{background:#000;color:#fff;border:none;padding:1rem 2rem;border-radius:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.625rem;transition:all 0.2s;margin:0 auto}
.btn-write-review:hover{background:#333;transform:translateY(-2px)}

/* Community Q&A (Poizon style) */
.community-qa{padding:3rem 0;margin:3rem 0;border-top:2px solid #f3f4f6}
.community-qa h2{font-size:1.75rem;font-weight:800;margin-bottom:2rem}
.qa-list{display:flex;flex-direction:column;gap:1.5rem;margin-bottom:2rem}
.qa-item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1.5rem}
.question{display:flex;align-items:start;gap:0.75rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid #f3f4f6}
.question i{color:#3b82f6;font-size:1.25rem;flex-shrink:0;margin-top:0.125rem}
.question span{font-weight:600;color:#000;font-size:1rem}
.answer{display:flex;align-items:start;gap:0.75rem;padding:1rem;background:#f9fafb;border-radius:8px;margin-top:1rem}
.answer i{color:#10b981;font-size:1.125rem;flex-shrink:0;margin-top:0.125rem}
.answer.best-answer{background:#ecfdf5;border:1px solid #d1fae5}
.answer-text{flex:1;line-height:1.6;color:#333;margin-bottom:0.75rem}
.answer-meta{display:flex;align-items:center;gap:1rem;flex-wrap:wrap;font-size:0.8125rem}
.answer-author{font-weight:600;color:#666}
.verified-buyer{color:#10b981;font-weight:600}
.btn-helpful-small{background:#fff;border:1px solid #e5e7eb;padding:0.25rem 0.75rem;border-radius:6px;font-size:0.8125rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:0.375rem;transition:all 0.2s}
.btn-helpful-small:hover{background:#f3f4f6}
.btn-ask-question{background:#3b82f6;color:#fff;border:none;padding:1rem 2rem;border-radius:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.625rem;transition:all 0.2s;margin:0 auto}
.btn-ask-question:hover{background:#2563eb;transform:translateY(-2px)}

/* Social Proof Widget (Poizon style) */
.social-proof-widget{background:linear-gradient(135deg,#f9fafb,#fff);border:2px solid #e5e7eb;border-radius:16px;padding:2rem;margin:3rem 0}
.proof-badge{display:inline-flex;align-items:center;gap:0.5rem;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:0.5rem 1rem;border-radius:8px;font-weight:700;font-size:0.875rem;margin-bottom:1.5rem}
.proof-badge i{font-size:1.125rem}
.proof-stats{display:grid;grid-template-columns:1fr;gap:1rem}
.proof-stat{display:flex;align-items:center;gap:0.75rem;padding:1rem;background:#fff;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,0.05)}
.proof-stat i{font-size:1.5rem;color:#fbbf24}
.proof-stat:nth-child(2) i{color:#10b981}
.proof-stat:nth-child(3) i{color:#ef4444}
.proof-stat span{font-size:0.9375rem;color:#666}
.proof-stat strong{color:#000;font-weight:700}

/* Sticky Purchase Bar (Poizon style) */
.sticky-purchase-bar{position:fixed;bottom:0;left:0;right:0;background:#fff;box-shadow:0 -4px 20px rgba(0,0,0,0.15);padding:1rem;display:none;align-items:center;gap:1rem;z-index:1000;transform:translateY(100%);transition:transform 0.3s;border-top:1px solid #e5e7eb}
.sticky-purchase-bar.visible{display:flex;transform:translateY(0)}
.sticky-product-info{display:flex;align-items:center;gap:0.75rem;flex:1}
.sticky-thumb{width:48px;height:48px;object-fit:cover;border-radius:8px;background:#f9fafb}
.sticky-details{flex:1;min-width:0}
.sticky-name{font-size:0.875rem;font-weight:600;color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sticky-price{font-size:1rem;font-weight:800;color:#000}
.sticky-add-cart{background:#000;color:#fff;border:none;padding:0.875rem 1.5rem;border-radius:10px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.2s;white-space:nowrap}
.sticky-add-cart:hover{background:#333}
.sticky-add-cart i{font-size:1.125rem}

@media (min-width:768px){
.reviews-summary{grid-template-columns:200px 1fr}
.rating-large-block{text-align:left}
.rating-stars-big{justify-content:flex-start}
.proof-stats{grid-template-columns:repeat(3,1fr)}
.specs-grid{grid-template-columns:repeat(2,1fr)}
}

@media (min-width:1024px){
.specs-grid{grid-template-columns:repeat(4,1fr)}
}

@media (max-width:767px){
.look-grid{grid-template-columns:1fr;gap:1.5rem}
.look-total{flex-direction:column}
.btn-add-all{width:100%;justify-content:center}
}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/cart.js"></script>
<script src="/js/favorites.js"></script>
<script>
function changeImg(src){
    document.getElementById('mainImg').src=src;
    document.getElementById('mainImgContainer').classList.remove('zoomed');
}

function toggleFav(e,id){
    e.stopPropagation();
    toggleFavorite(id, e.currentTarget);
}

function toggleZoom(){
    document.getElementById('mainImgContainer').classList.toggle('zoomed');
}

function createOrder(){
    const productId = <?= $product->id ?>;
    const sizeInput = document.querySelector('input[name="size"]:checked');
    const size = sizeInput ? sizeInput.value : null;
    
    if (!size && <?= !empty($product->sizes) ? 'true' : 'false' ?>) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä');
        return;
    }
    
    if (typeof addToCart === 'function') {
        addToCart(productId, 1, size, null);
    } else {
        alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }
}

// Sticky Purchase Bar - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
window.addEventListener('scroll', function() {
    const stickyBar = document.getElementById('stickyBar');
    const mainBtn = document.querySelector('.btn-order');
    
    if (!stickyBar || !mainBtn) return;
    
    const rect = mainBtn.getBoundingClientRect();
    
    if (rect.top < 0) {
        stickyBar.classList.add('visible');
    } else {
        stickyBar.classList.remove('visible');
    }
});

// Live viewers count - —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
function updateViewersCount() {
    const viewersEl = document.getElementById('viewersCount');
    if (!viewersEl) return;
    
    const min = 3;
    const max = 15;
    const count = Math.floor(Math.random() * (max - min + 1)) + min;
    viewersEl.textContent = count;
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É –∏ –ø–æ—Ç–æ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
updateViewersCount();
setInterval(updateViewersCount, 10000);

// Review filters
document.querySelectorAll('.review-filters .filter-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Remove active from all
        document.querySelectorAll('.review-filters .filter-btn').forEach(b => b.classList.remove('active'));
        // Add to clicked
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX –∑–∞–ø—Ä–æ—Å
        console.log('Filter reviews by:', filter);
    });
});

// Complete the look - –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
function addCompleteLook() {
    <?php if (!empty($similarProducts)): ?>
    const items = [<?= $product->id ?>, <?= implode(',', array_map(function($p) { return $p->id; }, array_slice($similarProducts, 0, 3))) ?>];
    
    if (typeof addToCart === 'function') {
        items.forEach(id => {
            addToCart(id, 1, null, null);
        });
        alert('üéÅ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –æ–±—Ä–∞–∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ—Ä–∑–∏–Ω—É!');
    } else {
        alert('–§—É–Ω–∫—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }
    <?php else: ?>
    alert('–ù–µ—Ç –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤');
    <?php endif; ?>
}

// Size Guide Modal
function openSizeGuide() {
    document.getElementById('sizeGuideModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeSizeGuide() {
    document.getElementById('sizeGuideModal').style.display = 'none';
    document.body.style.overflow = '';
}

function recommendSize() {
    const footLength = parseFloat(document.getElementById('footLength').value);
    const resultEl = document.getElementById('sizeRecommendation');
    
    if (!footLength || footLength < 20 || footLength > 35) {
        resultEl.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–ª–∏–Ω—É —Å—Ç–æ–ø—ã (20-35 —Å–º)';
        resultEl.style.background = '#fef2f2';
        resultEl.style.borderColor = '#ef4444';
        resultEl.style.color = '#dc2626';
        resultEl.classList.add('show');
        return;
    }
    
    // –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–ª–∏–Ω—ã —Å—Ç–æ–ø—ã –∏ —Ä–∞–∑–º–µ—Ä–∞
    const sizeChart = [
        {cm: 24.0, size: 38},
        {cm: 24.5, size: 39},
        {cm: 25.0, size: 40},
        {cm: 26.0, size: 41},
        {cm: 27.0, size: 42},
        {cm: 28.0, size: 43},
        {cm: 29.0, size: 44},
        {cm: 30.0, size: 45},
    ];
    
    // –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–∞–∑–º–µ—Ä
    let recommendedSize = 38;
    for (let i = 0; i < sizeChart.length; i++) {
        if (footLength <= sizeChart[i].cm) {
            recommendedSize = sizeChart[i].size;
            break;
        }
        if (i === sizeChart.length - 1 && footLength > sizeChart[i].cm) {
            recommendedSize = 45;
        }
    }
    
    resultEl.textContent = `‚úì –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ä–∞–∑–º–µ—Ä: ${recommendedSize} (EU/RU)`;
    resultEl.style.background = '#ecfdf5';
    resultEl.style.borderColor = '#10b981';
    resultEl.style.color = '#059669';
    resultEl.classList.add('show');
    
    // –ü–æ–¥—Å–≤–µ—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤ —Ç–∞–±–ª–∏—Ü–µ
    document.querySelectorAll('.size-table tr').forEach(row => {
        row.style.background = '';
    });
    const recommendedRow = document.querySelector(`.size-table tr:has(td:first-child strong:contains("${recommendedSize}"))`);
    if (recommendedRow) {
        recommendedRow.style.background = '#ecfdf5';
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ Size Guide –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
document.addEventListener('click', function(e) {
    const modal = document.getElementById('sizeGuideModal');
    if (e.target === modal) {
        closeSizeGuide();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeSizeGuide();
    }
});

function showNotification(message, type = 'info') {
    const notification = $('<div class="notification notification-' + type + '">' + message + '</div>');
    $('body').append(notification);
    setTimeout(() => notification.addClass('show'), 10);
    setTimeout(() => {
        notification.removeClass('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Back button event listener
document.addEventListener('DOMContentLoaded', function() {
    const backBtn = document.getElementById('backBtn');
    if (backBtn) {
        backBtn.addEventListener('click', function(e) {
            e.preventDefault();
            history.back();
        });
    }
});
</script>

<style>
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    transform: translateX(400px);
    transition: transform 0.3s;
}
.notification.show {
    transform: translateX(0);
}
.notification-success {
    border-left: 4px solid #10b981;
}
.notification-error {
    border-left: 4px solid #ef4444;
}
.notification-info {
    border-left: 4px solid #3b82f6;
}
</style>
