# üì¶ –°–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞

**–î–∞—Ç–∞:** 06.11.2025, 10:27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üéØ –ó–∞–¥–∞—á–∞

–ò—Å–∫–ª—é—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `stock_status = 'out_of_stock'` (–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏) –∏–∑ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∫–∞—Ç–∞–ª–æ–≥–∞.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≤–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ `CatalogController`, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–≤–æ–¥—è—Ç —Å–ø–∏—Å–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:

```php
->andWhere(['!=', 'stock_status', Product::STOCK_OUT_OF_STOCK])
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

| –ú–µ—Ç–æ–¥ | –°—Ç—Ä–æ–∫–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|------------|
| `actionIndex()` | 67 | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ |
| `actionBrand()` | 305 | –ö–∞—Ç–∞–ª–æ–≥ –ø–æ –±—Ä–µ–Ω–¥—É |
| `actionCategory()` | 370 | –ö–∞—Ç–∞–ª–æ–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| `actionSearch()` | 167 | –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –ø–æ–∏—Å–∫–∞ |
| `actionFilterSef()` | 922 | SEF —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| `actionFilter()` | 1162 | AJAX —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| `actionSearchProducts()` | 1238 | –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ |
| `actionLoadMore()` | 1302 | –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ |
| `getFiltersData()` | 842 | –î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ |
| `getAvailableFilters()` | 1030 | –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã |

**–ò—Ç–æ–≥–æ:** **10 –º–µ—Ç–æ–¥–æ–≤** –æ–±–Ω–æ–≤–ª–µ–Ω–æ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞**

```
URL: /catalog
–û–∂–∏–¥–∞–µ—Ç—Å—è: –¢–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ (stock_status != 'out_of_stock')
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –±—Ä–µ–Ω–¥—É**

```
URL: /catalog/brand/nike
–û–∂–∏–¥–∞–µ—Ç—Å—è: –¢–æ–ª—å–∫–æ Nike –≤ –Ω–∞–ª–∏—á–∏–∏
```

### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**

```
URL: /catalog/category/sneakers
–û–∂–∏–¥–∞–µ—Ç—Å—è: –¢–æ–ª—å–∫–æ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –≤ –Ω–∞–ª–∏—á–∏–∏
```

### **4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫**

```
URL: /catalog/search?q=dunk
–û–∂–∏–¥–∞–µ—Ç—Å—è: –í –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏
```

### **5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã**

```
–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º –≤ –Ω–∞–ª–∏—á–∏–∏
–ë—Ä–µ–Ω–¥—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏
```

---

## üîç SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
SELECT id, name, stock_status, is_active
FROM product
WHERE is_active = 1 
  AND stock_status = 'out_of_stock';

-- –≠—Ç–∏ —Ç–æ–≤–∞—Ä—ã –ù–ï –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ stock_status

### **–í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**

```php
const STOCK_IN_STOCK = 'in_stock';        // –í –Ω–∞–ª–∏—á–∏–∏ ‚úÖ
const STOCK_OUT_OF_STOCK = 'out_of_stock'; // –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏ ‚ùå
const STOCK_PREORDER = 'preorder';         // –ü—Ä–µ–¥–∑–∞–∫–∞–∑ ‚è≥
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–≤–∞—Ä–∞:**

```php
// –í –∞–¥–º–∏–Ω–∫–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç
$product->stock_status = Product::STOCK_OUT_OF_STOCK;
$product->save();
```

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –æ—Å—Ç–∞—Ç–∫–æ–≤:**

```php
// –í –∏–º–ø–æ—Ä—Ç–µ Poizon (commands/PoizonImportJsonController.php)
$size->stock = $childData['count'] ?? 0;
$size->is_available = !empty($childData['available']) ? 1 : 0;

// –û–±–Ω–æ–≤–ª—è–µ–º stock_status —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–æ–≤
$product->stock_status = $product->hasAvailableSizes() 
    ? Product::STOCK_IN_STOCK 
    : Product::STOCK_OUT_OF_STOCK;
```

---

## üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```sql
SELECT * FROM product WHERE is_active = 1;
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 1000 —Ç–æ–≤–∞—Ä–æ–≤ (–≤–∫–ª—é—á–∞—è 100 "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏")
```

### **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```sql
SELECT * FROM product 
WHERE is_active = 1 
  AND stock_status != 'out_of_stock';
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 900 —Ç–æ–≤–∞—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏)
```

**–í–ª–∏—è–Ω–∏–µ:**
- ‚úÖ –ó–∞–ø—Ä–æ—Å–æ–≤: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å)
- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å: +10% (–º–µ–Ω—å—à–µ —Å—Ç—Ä–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- ‚úÖ UX: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏":**

–£–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:

```php
// –û–ø—Ü–∏—è 1: –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã (–≤–∫–ª—é—á–∞—è "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏")
if (!$request->get('show_out_of_stock')) {
    $query->andWhere(['!=', 'stock_status', Product::STOCK_OUT_OF_STOCK]);
}

// –û–ø—Ü–∏—è 2: –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞" —Å —Ç–æ–≤–∞—Ä–∞–º–∏ "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏"
public function actionClearance()
{
    $query = Product::find()
        ->where(['is_active' => 1, 'stock_status' => Product::STOCK_OUT_OF_STOCK])
        ->andWhere(['>', 'old_price', 0]); // –¢–æ–ª—å–∫–æ —Å–æ —Å–∫–∏–¥–∫–æ–π
}
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionIndex()` (–≥–ª–∞–≤–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionBrand()` (–∫–∞—Ç–∞–ª–æ–≥ –ø–æ –±—Ä–µ–Ω–¥—É)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionCategory()` (–∫–∞—Ç–∞–ª–æ–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionSearch()` (–∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionFilterSef()` (SEF URL)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionFilter()` (AJAX —Ñ–∏–ª—å—Ç—Ä—ã)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionSearchProducts()` (–ø–æ–∏—Å–∫)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `actionLoadMore()` (–ø–æ–¥–≥—Ä—É–∑–∫–∞)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `getFiltersData()` (–¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `getAvailableFilters()` (—Ñ–∏–ª—å—Ç—Ä—ã)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ production

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å–µ —Ç–æ–≤–∞—Ä—ã "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞!**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Ç–æ–≤–∞—Ä—ã.

---

**–§–∞–π–ª:** `controllers/CatalogController.php`  
**–ò–∑–º–µ–Ω–µ–Ω–æ —Å—Ç—Ä–æ–∫:** ~10  
**–ú–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:** 10
