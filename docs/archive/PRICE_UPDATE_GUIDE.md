# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ª—å–∫—É–ª—è—Ü–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Poizon **—Ü–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞:

```bash
# –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ (—Ü–µ–Ω—ã –∫–∞–ª—å–∫—É–ª–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
php yii poizon-import/run
php yii poizon-import/from-file –ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.json
```

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã:
```
1. –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ = (price_cny √ó –∫—É—Ä—Å_CNY_BYN √ó 1.5) + 40 BYN
2. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (xx9)
```

**–ì–¥–µ:**
- `price_cny` ‚Äî —Ü–µ–Ω–∞ –≤ —é–∞–Ω—è—Ö –∏–∑ Poizon
- `–∫—É—Ä—Å_CNY_BYN` ‚Äî —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.45, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `1.5` ‚Äî –Ω–∞—Ü–µ–Ω–∫–∞ (50%)
- `40 BYN` ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è

**–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ xx9:**
- 454.21 ‚Üí **449** BYN
- 523.36 ‚Üí **519** BYN
- 661.66 ‚Üí **659** BYN
- 1284.01 ‚Üí **1279** BYN
- –¶–µ–Ω–∞ –≤—Å–µ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 9 (–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ)

---

## –ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ü–µ–Ω—ã –¥–ª—è —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫—É—Ä—Å–∞):

```bash
php yii poizon-import/update-prices
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞:

1. **–ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å CNY ‚Üí BYN**
   - –ò–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ò–ª–∏ —á–µ—Ä–µ–∑ API –ù–∞—Ü–±–∞–Ω–∫–∞ –†–ë
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (0.45)

2. **–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤** (`product.price`)
   - –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `poizon_price_cny`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ `price`

3. **–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã —Ä–∞–∑–º–µ—Ä–æ–≤** (`product_size.price_byn`)
   - –î–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —Å `price_cny` –∏–ª–∏ `poizon_price_cny`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ `price_byn`

4. **–í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥**
   - –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: "–¢–æ–≤–∞—Ä #123: 100 ‚Üí 150 BYN"
   - –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üîÑ –ü–ï–†–ï–°–ß–ï–¢ –¶–ï–ù –¢–û–í–ê–†–û–í                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìä –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å CNY ‚Üí BYN: 0.45
üìê –§–æ—Ä–º—É–ª–∞: (CNY √ó –∫—É—Ä—Å √ó 1.5) + 40 BYN

‚úÖ –†–∞–∑–º–µ—Ä #1 (—Ç–æ–≤–∞—Ä #5): 599.00 ‚Üí 454.21 BYN
‚úÖ –†–∞–∑–º–µ—Ä #2 (—Ç–æ–≤–∞—Ä #5): 649.00 ‚Üí 488.78 BYN
‚úÖ –†–∞–∑–º–µ—Ä #3 (—Ç–æ–≤–∞—Ä #6): 799.00 ‚Üí 592.36 BYN
...

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚úÖ –ü–ï–†–ï–°–ß–ï–¢ –ó–ê–í–ï–†–®–ï–ù                              ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  –¢–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:  0                             ‚ïë
‚ïë  –†–∞–∑–º–µ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: 601                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ö—É—Ä—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ API –ù–∞—Ü–±–∞–Ω–∫–∞ –†–ë:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: https://api.nbrb.by/exrates/rates/CNY
- **–ö—ç—à**: 24 —á–∞—Å–∞
- **Fallback**: ExchangeRate-API (–µ—Å–ª–∏ –ù–ë–†–ë –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

### 2. –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É—Ä—Å–∞

–ò–∑–º–µ–Ω–∏—Ç—å –≤ `/config/web.php`:

```php
'currency' => [
    'class' => 'app\components\CurrencyService',
    'cnyToBynRate' => 0.47, // –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    'cacheDuration' => 86400,
],
```

### 3. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∫—É—Ä—Å–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å:

```bash
php yii cache/flush
```

---

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ**, –µ—Å–ª–∏:
- –ò–∑–º–µ–Ω–∏–ª—Å—è –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã
- –ò–∑–º–µ–Ω–∏–ª–∞—Å—å —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ (–Ω–∞—Ü–µ–Ω–∫–∞, –∫–æ–º–∏—Å—Å–∏—è)
- –¢–æ–≤–∞—Ä—ã –±—ã–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ —Ü–µ–Ω (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –ù—É–∂–Ω–æ –º–∞—Å—Å–æ–≤–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã

‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ**, –µ—Å–ª–∏:
- –¢–æ–≤–∞—Ä—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (—Ü–µ–Ω—ã —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã)
- –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `product` ‚Äî –ø–æ–ª–µ `price`
- `product_size` ‚Äî –ø–æ–ª—è `price_cny`, `price_byn`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `CurrencyService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏ –∏ —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω
- `PoizonImportController` ‚Äî –∏–º–ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ—Å—á–µ—Ç

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `/config/web.php` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ `currency`
- `/config/params.php` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API Poizon

---

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞?**  
A: –î–∞, –≤ `/components/CurrencyService.php` ‚Üí –º–µ—Ç–æ–¥ `calculatePoizonPriceByn()`

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É —Å 1.5 –Ω–∞ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?**  
A: –í `CurrencyService::calculatePoizonPriceByn()` –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `$markup`

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é 40 BYN?**  
A: –í `CurrencyService::calculatePoizonPriceByn()` –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `$fixedFee`

**Q: –ü–æ—á–µ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "‚Üí 40 BYN"?**  
A: –£ —ç—Ç–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –Ω–µ—Ç `price_cny` (–ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ), –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è

**Q: –ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É —Ç–æ–≤–∞—Ä–æ–≤/—Ä–∞–∑–º–µ—Ä–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ `poizon_price_cny` –∏–ª–∏ `price_cny`

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –õ–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
php yii poizon-import/logs

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
php yii poizon-import/logs 5
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:

```bash
php yii poizon-import/test
```
