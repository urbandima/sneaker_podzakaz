# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π JSON ‚Üí Product

## üìã –ü–æ–ª—è –≤ JSON

### –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–≤–∞—Ä (products[])
```json
{
  "productId": 392655,           // ID —Ç–æ–≤–∞—Ä–∞
  "variantId": 392655,            // ID –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è = productId)
  "url": "https://...",           // –°—Å—ã–ª–∫–∞ –Ω–∞ Poizon
  "title": "Nike Dunk Low...",    // –ù–∞–∑–≤–∞–Ω–∏–µ
  "description": "",              // –û–ø–∏—Å–∞–Ω–∏–µ
  "vendorCode": "355152-106",     // –ê—Ä—Ç–∏–∫—É–ª
  "categoryId": 8699,             // ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  "vendorId": 24,                 // ID –±—Ä–µ–Ω–¥–∞
  "vendor": "Nike",               // –ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞
  "images": [...],                // –ú–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ
  "price": 490,                   // –¶–µ–Ω–∞ (BYN/RUB)
  "favoriteCount": 0,             // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
  "countryOfOrigin": "–ö–∏—Ç–∞–π",     // –°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
  "gender": "–£–Ω–∏—Å–µ–∫—Å",            // –ü–æ–ª
  "seriesName": "",               // –°–µ—Ä–∏—è
  "vat": "NO_VAT",                // –ù–î–°
  "currency": "RUR",              // –í–∞–ª—é—Ç–∞
  "keywords": [...],              // –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
  "properties": [...],            // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
  "sizes": [...],                 // –†–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏
  "relatedProducts": [...],       // –ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã
  "children": [...]               // –í–∞—Ä–∏–∞–Ω—Ç—ã (—Ä–∞–∑–º–µ—Ä—ã)
}
```

### –î–æ—á–µ—Ä–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç (children[])
```json
{
  "productId": 392655,            // ID —Ç–æ–≤–∞—Ä–∞ (—Ä–æ–¥–∏—Ç–µ–ª—è)
  "parentId": 392655,             // ID —Ä–æ–¥–∏—Ç–µ–ª—è
  "variantId": 659423919,         // ID –≤–∞—Ä–∏–∞–Ω—Ç–∞ (SKU)
  "title": "...",                 // –ù–∞–∑–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–º–µ—Ä–æ–º
  "vendorCode": "355152-106-1",   // –ê—Ä—Ç–∏–∫—É–ª –≤–∞—Ä–∏–∞–Ω—Ç–∞
  "price": 0,                     // –¶–µ–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
  "purchasePrice": 0,             // –ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ (CNY)
  "count": 0,                     // –û—Å—Ç–∞—Ç–æ–∫
  "available": false,             // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
  "timeDelivery": {
    "min": 15,
    "max": 24
  },
  "params": [                     // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞—Ä–∏–∞–Ω—Ç–∞
    {"key": "–¶–≤–µ—Ç", "value": "–ë–µ–ª–æ–µ"},
    {"key": "–†–∞–∑–º–µ—Ä", "value": "38"}
  ],
  "images": [...],                // –§–æ—Ç–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
  "vendor": "Nike",
  "seriesName": "",
  "keywords": [...]
}
```

---

## ‚úÖ –¢–ï–ö–£–©–ò–ô –ú–ê–ü–ü–ò–ù–ì

### Product (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–≤–∞—Ä)

| JSON –ø–æ–ª–µ | Product –ø–æ–ª–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------------|--------|-------------|
| `productId` | `poizon_id` | ‚úÖ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ |
| `variantId` | ‚ùå | ‚úÖ | –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è |
| `title` | `name` | ‚úÖ | |
| `description` | `description` | ‚úÖ | |
| `vendorCode` | `vendor_code` | ‚úÖ | |
| `url` | `poizon_url` | ‚úÖ | |
| `price` | `price` | ‚úÖ | |
| `categoryId` | `category_id` | ‚úÖ | –ß–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ Category |
| `vendorId` | `brand_id` | ‚úÖ | –ß–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ Brand |
| `vendor` | `brand_name` | ‚úÖ | –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è |
| `images[0]` | `main_image` | ‚úÖ | –ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ |
| `images[]` | ProductImage | ‚úÖ | –í—Å–µ —Ñ–æ—Ç–æ |
| `countryOfOrigin` | `country_of_origin` | ‚úÖ | |
| `favoriteCount` | `favorite_count` | ‚úÖ | |
| `gender` | `gender` | ‚úÖ | –ß–µ—Ä–µ–∑ `mapGender()` |
| `seriesName` | `series_name` | ‚úÖ | |
| `properties` | `properties` | ‚úÖ | JSON |
| `sizes` | `sizes_data` | ‚úÖ | JSON |
| `keywords` | `keywords` | ‚úÖ | JSON |
| `vat` | ‚ùå | ‚ö†Ô∏è | **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** |
| `currency` | ‚ùå | ‚ö†Ô∏è | **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** |
| `relatedProducts` | ‚ùå | ‚ö†Ô∏è | **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** |

### ProductSize (–∏–∑ children[])

| JSON –ø–æ–ª–µ | ProductSize –ø–æ–ª–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|------------------|--------|-------------|
| `variantId` | `poizon_sku_id` | ‚úÖ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π SKU |
| `params[–†–∞–∑–º–µ—Ä]` | `size`, `us_size`, `eu_size`, `uk_size` | ‚úÖ | –ü–∞—Ä—Å–∏—Ç—Å—è |
| `count` | `stock`, `poizon_stock` | ‚úÖ | |
| `purchasePrice` | `poizon_price_cny` | ‚úÖ | –í —é–∞–Ω—è—Ö |
| `price` | `price` | ‚úÖ | –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞ |
| `available` | `is_available` | ‚úÖ | |
| `params[–¶–≤–µ—Ç]` | ‚ùå | ‚ö†Ô∏è | **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** |
| `timeDelivery` | ‚ùå | ‚ö†Ô∏è | **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** |

---

## ‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –ù–ï –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è

**–ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**:
- `vat` (–ù–î–°) - –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞–∂–Ω–æ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏
- `currency` (–≤–∞–ª—é—Ç–∞) - –≤—Å–µ–≥–¥–∞ "RUR", –Ω–æ —Å—Ç–æ–∏—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- `relatedProducts` (–ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã) - –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- `timeDelivery` (—Å—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏) - –≤–∞–∂–Ω–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞!
- `params[–¶–≤–µ—Ç]` –∏–∑ children - —Ü–≤–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞

---

### 2. ‚ö†Ô∏è –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –≤ properties

**–ü—Ä–æ–±–ª–µ–º–∞**: –í `properties` –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ–ª—è–º–∏:

```json
"properties": [
  {"key": "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç–∏–ª—è", "value": "355152-106"},  // = vendorCode
  {"key": "–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç", "value": "–ë–µ–ª—ã–π"},              // –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
  {"key": "–ö–æ–º–±–∏–Ω–∞—Ü–∏—è", "value": "–ë–µ–ª—ã–π"},                 // –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
  {"key": "–†–µ–ª–∏–∑ –°–≤–∏–¥–∞–Ω–∏–µ", "value": "09/27/2024"}         // –º–æ–∂–Ω–æ –≤ release_date
]
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- ‚úÖ –í—Å–µ `properties` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ JSON –ø–æ–ª–µ `product.properties`
- ‚ùå –ù–æ –ù–ï –ø–∞—Ä—Å—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (`color`, `release_year`, etc.)

---

### 3. ‚ö†Ô∏è sizes[] –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è ProductSize

**–í JSON –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏**:
```json
"sizes": [
  {"name": "–ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–π –∫–æ–¥–µ–∫—Å –ï–°", "value": "35.5,36,36.5,..."},
  {"name": "–ö–æ–¥–µ–∫—Å –∫—Ä–∞—Å–æ—Ç—ã –°–®–ê", "value": "3.5,4,4.5,..."}
]
```

**–ü—Ä–æ–±–ª–µ–º–∞**:
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `product.sizes_data` (JSON)
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è `ProductSize.eu_size`, `us_size`
- ‚ùå –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–º –∏–∑ `children[].params[–†–∞–∑–º–µ—Ä]`
- ‚ö†Ô∏è –ï—Å–ª–∏ –≤ params –Ω–µ—Ç "EU 42 / US 8.5", —Ä–∞–∑–º–µ—Ä—ã —Ç–µ—Ä—è—é—Ç—Å—è!

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –≤ Product

```php
// –ú–∏–≥—Ä–∞—Ü–∏—è
ALTER TABLE product ADD COLUMN vat VARCHAR(50);
ALTER TABLE product ADD COLUMN currency VARCHAR(10) DEFAULT 'BYN';
ALTER TABLE product ADD COLUMN delivery_time_min INT;
ALTER TABLE product ADD COLUMN delivery_time_max INT;
```

**–í –∏–º–ø–æ—Ä—Ç–µ**:
```php
$product->vat = $data['vat'] ?? null;
$product->currency = $data['currency'] ?? 'BYN';
```

---

### 2. –ü–∞—Ä—Å–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ properties

**–î–æ–±–∞–≤–∏—Ç—å –≤ `parseProperties()`**:
```php
private function parseProperties($product, $properties)
{
    foreach ($properties as $prop) {
        $key = mb_strtolower($prop['key']);
        $value = $prop['value'];
        
        // –†–µ–ª–∏–∑ –¥–∞—Ç–∞
        if (strpos($key, '—Ä–µ–ª–∏–∑') !== false || strpos($key, 'release') !== false) {
            if (preg_match('/(\d{4})/', $value, $matches)) {
                $product->release_year = $matches[1];
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç
        if (strpos($key, '–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç') !== false || strpos($key, 'color') !== false) {
            $product->color_description = $value;
        }
        
        // –¢–∏–ø –∑–∞–∫—Ä—ã—Ç–∏—è ‚Üí fastening
        if (strpos($key, '–∑–∞–∫—Ä—ã—Ç–∏—è') !== false) {
            $product->fastening = $this->mapFastening($value);
        }
        
        // –í—ã—Å–æ—Ç–∞ ‚Üí height
        if (strpos($key, '–≤—ã—Å–æ—Ç–∞') !== false || strpos($key, '–≥–æ–ª–µ–Ω–∏—â–∞') !== false) {
            $product->height = $this->mapHeight($value);
        }
    }
}
```

---

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sizes[] –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ–π—á–∞—Å –ø–æ–ª–∞–≥–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `children[].params[–†–∞–∑–º–µ—Ä]`

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sizes[]` –∫–∞–∫ lookup —Ç–∞–±–ª–∏—Ü—É:
```php
private function importSizes($product, $children)
{
    // –°–æ–∑–¥–∞–µ–º lookup —Ç–∞–±–ª–∏—Ü—É –∏–∑ sizes
    $sizesLookup = $this->buildSizesLookup($product->sizes_data);
    
    foreach ($children as $childData) {
        $sizeValue = $this->extractSize($childData['params']);
        
        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ä–∞–∑–º–µ—Ä, –∏—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ lookup
        if ($sizeValue && isset($sizesLookup[$sizeValue])) {
            $size->us_size = $sizesLookup[$sizeValue]['us'];
            $size->eu_size = $sizesLookup[$sizeValue]['eu'];
            $size->uk_size = $sizesLookup[$sizeValue]['uk'];
            $size->cm_size = $sizesLookup[$sizeValue]['cm'];
        }
    }
}
```

---

### 4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ü–≤–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ ProductSize**:
```php
// –ú–∏–≥—Ä–∞—Ü–∏—è
ALTER TABLE product_size ADD COLUMN color VARCHAR(100);
```

**–í –∏–º–ø–æ—Ä—Ç–µ**:
```php
foreach ($childData['params'] as $param) {
    if (strpos(mb_strtolower($param['key']), '—Ü–≤–µ—Ç') !== false) {
        $size->color = $param['value'];
    }
}
```

---

### 5. –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

**–£–∂–µ –µ—Å—Ç—å –ø–æ–ª—è –≤ Product**:
- `delivery_time_min`
- `delivery_time_max`

**–ó–∞–ø–æ–ª–Ω—è—Ç—å –∏–∑ children**:
```php
if (!empty($childData['timeDelivery'])) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    $product->delivery_time_min = min(
        $product->delivery_time_min ?? 999,
        $childData['timeDelivery']['min']
    );
    $product->delivery_time_max = max(
        $product->delivery_time_max ?? 0,
        $childData['timeDelivery']['max']
    );
}
```

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

- [x] ~~`products_count` ‚Üí `count` –≤ brand.php~~ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- [ ] –ü–∞—Ä—Å–∏—Ç—å `properties` ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (color, release_year, etc.)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sizes[]` –¥–ª—è lookup —Ä–∞–∑–º–µ—Ä–æ–≤
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å `timeDelivery` –∏–∑ children
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ü–≤–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ ProductSize

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

- [ ] –ü–æ–ª–µ `vat` –≤ Product
- [ ] –ü–æ–ª–µ `currency` –≤ Product  
- [ ] –°–≤—è–∑—å `relatedProducts` (—á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É many-to-many)
- [ ] –ò–º–ø–æ—Ä—Ç `vendor` –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏, –µ—Å–ª–∏ Brand –Ω–µ –Ω–∞–π–¥–µ–Ω

---

## üìä –¢–ï–ö–£–©–ï–ï –ü–û–ö–†–´–¢–ò–ï –ü–û–õ–ï–ô

**–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: 18 –∏–∑ 23 –ø–æ–ª–µ–π (78%)  
**–ù–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: 5 –ø–æ–ª–µ–π (22%)

**ProductSize**: 7 –∏–∑ 10 –ø–æ–ª–µ–π (70%)  
**ProductImage**: 100% ‚úÖ

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–ª–æ–º–∞–Ω UX)
1. ‚úÖ ~~–û—à–∏–±–∫–∞ `products_count`~~ - **–ò–°–ü–†–ê–í–õ–ï–ù–û**

### üü° –í–∞–∂–Ω–æ (—Ç–µ—Ä—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ)
2. –ü–∞—Ä—Å–∏–Ω–≥ `properties` ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `timeDelivery`
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sizes[]` –¥–ª—è ProductSize

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (—É–ª—É—á—à–µ–Ω–∏–µ)
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `vat`, `currency`
6. –ò–º–ø–æ—Ä—Ç `relatedProducts`
7. –¶–≤–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞

---

**–ì–æ—Ç–æ–≤–æ!** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∞–ø–ø–∏–Ω–≥—É –ø–æ–ª–µ–π —Å–æ–∑–¥–∞–Ω–∞.
