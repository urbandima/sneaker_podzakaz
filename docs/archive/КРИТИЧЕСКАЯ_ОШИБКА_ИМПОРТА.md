# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ò–ú–ü–û–†–¢–ê!

**–î–∞—Ç–∞**: 05.11.2024, 06:36  
**–°—Ç–∞—Ç—É—Å**: ‚ùå –ì–†–£–ë–´–ï –û–®–ò–ë–ö–ò –í –ò–ú–ü–û–†–¢–ï

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #1: –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –¢–û–í–ê–†–û–í

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
4 —Ç–æ–≤–∞—Ä–∞ (Product)
61 —Ä–∞–∑–º–µ—Ä (ProductSize)
```

### –ß—Ç–æ –µ—Å—Ç—å –≤ –ë–î:
```
64 —Ç–æ–≤–∞—Ä–∞ (Product) ‚ùå
61 —Ä–∞–∑–º–µ—Ä (ProductSize) –Ω–æ —Å–≤—è–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º —Ç–æ–≤–∞—Ä–æ–º
```

**–î–µ—Ç–∞–ª–∏**:
- 4 —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–∞ (id: 121-124) - –ë–ï–ó —Ä–∞–∑–º–µ—Ä–æ–≤
- 60 –¥–æ—á–µ—Ä–Ω–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ (id: 125-184) - —ç—Ç–æ CHILDREN –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Å—Ç–∞—Ç—å ProductSize!

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: –†–ê–ó–ú–ï–†–´ –ù–ï –°–û–ó–î–ê–Æ–¢–°–Ø

### –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
```sql
SELECT p.id, p.name, COUNT(ps.id) as sizes_count 
FROM product p 
LEFT JOIN product_size ps ON p.id = ps.product_id 
WHERE p.poizon_id IS NOT NULL 
GROUP BY p.id;

+-----+-----------------------------+-------------+
| id  | name                        | sizes_count |
+-----+-----------------------------+-------------+
| 121 | Nike Dunk Low               |          16 | ‚úÖ –¢–û–õ–¨–ö–û –û–î–ò–ù!
| 122 | –ù–∞–π–∫ –î–∞–Ω–∫                   |           0 | ‚ùå
| 123 | Nike Kobe 8                 |           0 | ‚ùå
| 124 | Nike Zoom Fly 6             |           0 | ‚ùå
| 125 | Nike Dunk Low (child)       |           0 | ‚ùå –ù–ï –î–û–õ–ñ–ï–ù –°–£–©–ï–°–¢–í–û–í–ê–¢–¨
| 126 | Nike Dunk Low (child)       |           0 | ‚ùå –ù–ï –î–û–õ–ñ–ï–ù –°–£–©–ï–°–¢–í–û–í–ê–¢–¨
... (–µ—â–µ 58 –¥—É–±–ª–µ–π)
+-----+-----------------------------+-------------+
```

**–í—ã–≤–æ–¥**: –¢–æ–ª—å–∫–æ —É –ø–µ—Ä–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å —Ä–∞–∑–º–µ—Ä—ã. –û—Å—Ç–∞–ª—å–Ω—ã–µ 3 —Ç–æ–≤–∞—Ä–∞ –ø—É—Å—Ç—ã–µ!

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #3: CHILDREN –°–¢–ê–õ–ò PRODUCT

–í JSON:
```json
{
  "productId": 392655,
  "children": [
    { "variantId": 123456, "params": {"size": "38"} },  // –î–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å ProductSize
    { "variantId": 123457, "params": {"size": "39"} },  // –î–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å ProductSize
    ...
  ]
}
```

–í –ë–î:
```sql
-- –í–º–µ—Å—Ç–æ ProductSize —Å–æ–∑–¥–∞–ª–∏—Å—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ Product!
| 125 | Nike Dunk Low | 392655 | parent_product_id=121 | ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
| 126 | Nike Dunk Low | 392655 | parent_product_id=121 | ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```sql
-- ProductSize –¥–ª—è product_id=121
| 1 | product_id=121 | size=38 | us_size=6 | eu_size=38 |
| 2 | product_id=121 | size=39 | us_size=6.5 | eu_size=39 |
```

---

## üîç –ü–†–ò–ß–ò–ù–ê –û–®–ò–ë–ö–ò

### –ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∞:

**–í `importProduct()`**:
```php
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑ children –∫–∞–∫ ProductSize
if (!empty($data['children'])) {
    $this->importSizes($product, $data['children'], $data['sizes'] ?? []);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ `importSizes()` –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø –∏–ª–∏ –ø–æ—Å–ª–µ –Ω–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π –∫–æ–¥!

### –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:

–ì–¥–µ-—Ç–æ –ï–©–ï –µ—Å—Ç—å –º–µ—Ç–æ–¥ `importVariants()` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç Product –¥–ª—è –∫–∞–∂–¥–æ–≥–æ children!

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–®–ò–ë–û–ö

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –û–∂–∏–¥–∞–ª–æ—Å—å | –ï—Å—Ç—å –≤ –ë–î | –°—Ç–∞—Ç—É—Å |
|------------|-----------|-----------|--------|
| **–¢–æ–≤–∞—Ä–æ–≤ Product** | 4 | 64 | ‚ùå +60 –ª–∏—à–Ω–∏—Ö |
| **–†–∞–∑–º–µ—Ä–æ–≤ ProductSize** | 61 (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã) | 61 (—Ç–æ–ª—å–∫–æ —É 1) | ‚ùå |
| **–¢–æ–≤–∞—Ä 121 —Ä–∞–∑–º–µ—Ä—ã** | 16-21 | 16 | ‚ö†Ô∏è |
| **–¢–æ–≤–∞—Ä 122 —Ä–∞–∑–º–µ—Ä—ã** | 13 | 0 | ‚ùå |
| **–¢–æ–≤–∞—Ä 123 —Ä–∞–∑–º–µ—Ä—ã** | 17 | 0 | ‚ùå |
| **–¢–æ–≤–∞—Ä 124 —Ä–∞–∑–º–µ—Ä—ã** | 15 | 0 | ‚ùå |

---

## üîß –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

### 1. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∞

–ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ `importVariants()` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç Product –¥–ª—è children.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤ importSizes()

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–≥–æ.

### 3. –û—á–∏—Å—Ç–∏—Ç—å –ë–î

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —Ç–æ–≤–∞—Ä—ã (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ProductSize)
DELETE FROM product WHERE parent_product_id IS NOT NULL AND poizon_id IS NOT NULL;

-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã
DELETE FROM product_size WHERE product_id IN (SELECT id FROM product WHERE poizon_id IS NOT NULL);
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç

```bash
php yii poizon-import-json/run "URL"
```

---

## ‚ö†Ô∏è –¢–ï–ö–£–©–ê–Ø –û–¶–ï–ù–ö–ê: 20/100

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (20 –±–∞–ª–ª–æ–≤):
- ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è (47 —à—Ç)
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è (22 —à—Ç)
- ‚úÖ –õ–æ–≥–æ—Ç–∏–ø—ã –±—Ä–µ–Ω–¥–æ–≤
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (vat, currency)

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (80 –±–∞–ª–ª–æ–≤ –ø–æ—Ç–µ—Ä—è–Ω–æ):
- ‚ùå **–¢–æ–≤–∞—Ä—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è** (64 –≤–º–µ—Å—Ç–æ 4)
- ‚ùå **–†–∞–∑–º–µ—Ä—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è** (—Ç–æ–ª—å–∫–æ —É 1 –∏–∑ 4)
- ‚ùå **Children —Å—Ç–∞–ª–∏ Product** –≤–º–µ—Å—Ç–æ ProductSize
- ‚ùå **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è**

---

## üéØ –°–†–û–ß–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

1. ‚úÖ –ù–∞–π—Ç–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ `importVariants()`
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
3. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `importSizes()`
4. ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

**–í–´–í–û–î**: –ò–º–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!
