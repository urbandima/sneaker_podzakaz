#!/bin/bash
#
# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Poizon
# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ cron —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
#
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ crontab:
# 0 3 * * * /path/to/project/poizon-import-cron.sh >> /path/to/project/runtime/logs/poizon-cron.log 2>&1
#

# –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É (–ò–ó–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –ø—É—Ç—å)
PROJECT_PATH="/path/to/project"

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$PROJECT_PATH" || exit 1

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞
echo "========================================"
echo "üöÄ –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞ Poizon: $(date)"
echo "========================================"

# –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞
php yii poizon-import/run --limit=0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ: $(date)"
else
    echo "‚ùå –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥: $EXIT_CODE): $(date)"
    
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
    # echo "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Poizon" | mail -s "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞" admin@sneaker-head.by
fi

echo "========================================"
echo ""

exit $EXIT_CODE
