# üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–µ—à–∞

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

‚ö†Ô∏è **Redis –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π FileCache

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Redis –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —É–ª—É—á—à–∏—Ç—Å—è –≤ **100 —Ä–∞–∑**.

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis —Å–µ—Ä–≤–µ—Ä

```bash
# macOS
brew install redis
brew services start redis

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install redis-server
sudo systemctl start redis
sudo systemctl enable redis

# CentOS/RHEL
sudo yum install redis
sudo systemctl start redis
sudo systemctl enable redis
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Redis

```bash
redis-cli ping
# –î–æ–ª–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å: PONG
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# macOS (—á–µ—Ä–µ–∑ PECL)
pecl install redis

# Ubuntu/Debian
sudo apt-get install php-redis

# –ü—Ä–æ–≤–µ—Ä–∫–∞
php -m | grep redis
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Yii2 Redis –ø–∞–∫–µ—Ç

```bash
cd /Users/user/CascadeProjects/splitwise
composer require yiisoft/yii2-redis
```

### –®–∞–≥ 5: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Redis –≤ –∫–æ–Ω—Ñ–∏–≥–µ

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `/config/web.php` –∏:

1. **–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** FileCache:
```php
// 'cache' => [
//     'class' => 'yii\caching\FileCache',
//     'cachePath' => '@runtime/cache',
// ],
```

2. **–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** Redis:
```php
'redis' => [
    'class' => 'yii\redis\Connection',
    'hostname' => 'localhost',
    'port' => 6379,
    'database' => 0,
],
'cache' => [
    'class' => 'yii\redis\Cache',
    'redis' => [
        'hostname' => 'localhost',
        'port' => 6379,
        'database' => 1,
    ],
    'keyPrefix' => 'sneakerhead:',
],
```

### –®–∞–≥ 6: –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–µ—à

```bash
rm -rf runtime/cache/*
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

```bash
# –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Redis
redis-cli
> KEYS sneakerhead:*
> GET sneakerhead:catalog_products_v1
> MONITOR  # –°–º–æ—Ç—Ä–µ—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | FileCache | Redis | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|-------|-----------|
| –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ | ~100ms | ~1ms | **100x** |
| Concurrent access | ‚ö†Ô∏è –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ | ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ | ‚úÖ –í—ã—Å–æ–∫–∞—è | –†–æ—Å—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ |
| Tagged cache | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å | –£–º–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è |

---

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –û—Å—Ç–∞–≤–∏—Ç—å FileCache

–ï—Å–ª–∏ Redis –Ω–µ –Ω—É–∂–µ–Ω —Å–µ–π—á–∞—Å, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å FileCache. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ:
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
- –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ concurrent access
- –°–ª–æ–∂–Ω–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å

–î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (< 1000 –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π/–¥–µ–Ω—å) FileCache –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

---

## ‚ö†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞: "Connection refused"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
brew services list | grep redis
# –∏–ª–∏
sudo systemctl status redis

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
brew services restart redis
# –∏–ª–∏
sudo systemctl restart redis
```

### –û—à–∏–±–∫–∞: "Class yii\redis\Cache not found"
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç
composer require yiisoft/yii2-redis

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
composer show | grep redis
```

### Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
redis-cli INFO memory
redis-cli CONFIG GET maxmemory

# –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
redis-cli CONFIG SET maxmemory 256mb
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Redis

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
redis-cli INFO stats
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏
```bash
redis-cli INFO memory
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π
```bash
redis-cli KEYS "sneakerhead:*"
```

### –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –≤—Ä—É—á–Ω—É—é
```bash
redis-cli FLUSHDB  # –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â—É—é –ë–î
```

---

## üéØ –ö–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Redis?

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ–π—á–∞—Å, –µ—Å–ª–∏:**
- –ü—Ä–æ–µ–∫—Ç –≤ production
- > 100 –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å, –µ—Å–ª–∏:**
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- < 100 –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π/–¥–µ–Ω—å
- –ù–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìû –ü–æ–º–æ—â—å

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π Redis, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ FileCache.

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Redis –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –≤ `/config/web.php`!
