# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –∏–º–ø–æ—Ä—Ç–∞ Poizon

**–î–∞—Ç–∞**: 04.11.2024  
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–æ–±–ª–µ–º—ã –≤—ã—è–≤–ª–µ–Ω—ã, —Ä–µ—à–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã

---

## üìã –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç poizonApi –≤ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–õ–æ–∫–∞—Ü–∏—è**: `/config/console.php`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `poizonApi` –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –≤ `/config/web.php` (–¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –í `/config/console.php` —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`PoizonImportController`) –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `poizonApi`

**–û—à–∏–±–∫–∞**:
```
Exception 'yii\base\InvalidConfigException' with message 'Unknown component ID: poizonApi'
```

**–ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è**:
```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
php yii poizon-import/run
php yii poizon-import/test
php yii poizon-import/update-prices

# –í—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É: Unknown component ID: poizonApi
```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã**:
- `commands/PoizonImportController.php` (—Å—Ç—Ä–æ–∫–∞ 66: `$this->poizonApi = Yii::$app->get('poizonApi')`)

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #2: –ò–º–ø–æ—Ä—Ç –∏–∑ JSON –º–æ–∂–µ—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ñ–∞–π–ª—ã

**–õ–æ–∫–∞—Ü–∏—è**: `commands/PoizonImportJsonController.php` (—Å—Ç—Ä–æ–∫–∞ 48)

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- –ò–º–ø–æ—Ä—Ç JSON —Ä–∞–±–æ—Ç–∞–µ—Ç, –ù–û –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `file_get_contents()` –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—ã–¥–∞–µ—Ç—Å—è –Ω–µ–∫—Ä–∞—Å–∏–≤–∞—è –æ—à–∏–±–∫–∞
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º

**–û—à–∏–±–∫–∞**:
```
PHP Warning: file_get_contents(https://example.com/test.json): 
Failed to open stream: HTTP request failed! HTTP/1.1 404 Not Found
```

**–ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è**:
```bash
# –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
php yii poizon-import-json/run "https://storage.yandexcloud.net/WRONG_URL.json"
```

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê #3: –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API –∏ XML URL

**–õ–æ–∫–∞—Ü–∏—è**: `/config/params.php`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `poizonApiKey` –∏ `poizonXmlUrl` –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `null`)
- –ë–µ–∑ —ç—Ç–æ–≥–æ –∏–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ API –∏ XML –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
```php
'poizonApiKey' => null,        // ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
'poizonXmlUrl' => null,        // ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
```

**–ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è**:
- API –∏–º–ø–æ—Ä—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–≤–∞—Ä—ã (–Ω–µ—Ç –∫–ª—é—á–∞)
- XML –∏–º–ø–æ—Ä—Ç –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∏–¥ (–Ω–µ—Ç URL)

---

## ‚úÖ –†–ï–®–ï–ù–ò–Ø

### üîß –†–ï–®–ï–ù–ò–ï #1: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç poizonApi –≤ console.php

**–§–∞–π–ª**: `/config/console.php`

**–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é 'components'**:

```php
'components' => [
    'cache' => [
        'class' => 'yii\caching\FileCache',
    ],
    'log' => [
        'targets' => [
            [
                'class' => 'yii\log\FileTarget',
                'levels' => ['error', 'warning'],
            ],
        ],
    ],
    'db' => $db,
    'authManager' => [
        'class' => 'yii\rbac\DbManager',
    ],
    'settings' => [
        'class' => 'app\components\Settings',
    ],
    'mailer' => [
        'class' => 'yii\symfonymailer\Mailer',
        'viewPath' => '@app/mail',
        'useFileTransport' => true,
    ],
    // ‚úÖ –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û:
    'poizonApi' => [
        'class' => 'app\components\PoizonApiService',
        'apiUrl' => $params['poizonApiUrl'] ?? 'https://api.poizon-parser.com/v1',
        'apiKey' => $params['poizonApiKey'] ?? null,
        'timeout' => 30,
    ],
    'urlManager' => [
        'class' => 'yii\web\UrlManager',
        'baseUrl' => 'http://localhost:8080',
        'scriptUrl' => 'http://localhost:8080',
        'enablePrettyUrl' => true,
        'showScriptName' => false,
    ],
],
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**:
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–º–ø–æ—Ä—Ç–∞ —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PoizonApiService`
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–∂–¥—É web –∏ console –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã `php yii poizon-import/*` –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç

---

### üîß –†–ï–®–ï–ù–ò–ï #2: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ JSON –∏–º–ø–æ—Ä—Ç–µ

**–§–∞–π–ª**: `commands/PoizonImportJsonController.php`

**–ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 46-53**:

```php
// –ë–´–õ–û:
$this->stdout("üì° –ó–∞–≥—Ä—É–∂–∞—é JSON –∏–∑: $jsonUrl\n");
$json = file_get_contents($jsonUrl);

if (!$json) {
    $this->stderr("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å JSON\n");
    return ExitCode::UNSPECIFIED_ERROR;
}

// –°–¢–ê–õ–û:
$this->stdout("üì° –ó–∞–≥—Ä—É–∂–∞—é JSON –∏–∑: $jsonUrl\n");

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞/URL
if (filter_var($jsonUrl, FILTER_VALIDATE_URL)) {
    // –≠—Ç–æ URL - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
    $headers = @get_headers($jsonUrl);
    if (!$headers || strpos($headers[0], '200') === false) {
        $this->stderr("‚ùå URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $jsonUrl\n");
        return ExitCode::DATAERR;
    }
} else {
    // –≠—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
    if (!file_exists($jsonUrl)) {
        $this->stderr("‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $jsonUrl\n");
        return ExitCode::DATAERR;
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
$json = @file_get_contents($jsonUrl);

if ($json === false) {
    $error = error_get_last();
    $this->stderr("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " . ($error['message'] ?? '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') . "\n");
    return ExitCode::UNSPECIFIED_ERROR;
}

if (empty($json)) {
    $this->stderr("‚ùå –§–∞–π–ª –ø—É—Å—Ç–æ–π\n");
    return ExitCode::DATAERR;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ HTTP –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ exit –∫–æ–¥—ã –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤

---

### üîß –†–ï–®–ï–ù–ò–ï #3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API

**–§–∞–π–ª**: `/config/params.php`

**–í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ XML —Ñ–∏–¥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)

```php
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Poizon/Dewu API
'poizonApiUrl' => 'https://api.poizon-parser.com/v1',
'poizonApiKey' => null, // –ù–µ –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º XML
'poizonXmlUrl' => 'https://s3.q-parser.ru/export/3539/668/4elk6gc/3539668--poizonshop.ru.xml', // ‚úÖ –£–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π URL
'cnyToBynRate' => 0.45, // 1 CNY ‚âà 0.45 BYN (–æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é)
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
```bash
php yii import/products  # –°—Ç–∞—Ä—ã–π –∏–º–ø–æ—Ä—Ç XML
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ API)

```php
'poizonApiUrl' => 'https://your-poizon-api.com/v1', // –†–µ–∞–ª—å–Ω—ã–π URL API
'poizonApiKey' => 'your-secret-api-key-here',       // ‚úÖ –í–∞—à API –∫–ª—é—á
'poizonXmlUrl' => null,
'cnyToBynRate' => 0.45,
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –¢–æ–ª—å–∫–æ –∏–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–æ–≤ (–±–µ–∑ API/XML)

```php
'poizonApiUrl' => 'https://api.poizon-parser.com/v1',
'poizonApiKey' => null,
'poizonXmlUrl' => null, // ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∏–¥—É
'cnyToBynRate' => 0.45,
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
# –ò–º–ø–æ—Ä—Ç –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ/—É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ JSON —Ñ–∞–π–ª–∞
php yii poizon-import-json/run "https://storage.yandexcloud.net/.../export.json"
php yii poizon-import-json/run "/path/to/local/file.json"

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# /admin/poizon-run ‚Üí Drag & Drop JSON —Ñ–∞–π–ª–∞
```

---

## üéØ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å console.php (5 –º–∏–Ω—É—Ç)

```bash
# –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
nano config/console.php

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç poizonApi (—Å–º. –†–ï–®–ï–ù–ò–ï #1 –≤—ã—à–µ)
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
php yii poizon-import/test
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!" –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
```

---

### –®–∞–≥ 2: –£–ª—É—á—à–∏—Ç—å JSON –∏–º–ø–æ—Ä—Ç (10 –º–∏–Ω—É—Ç)

```bash
# –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
nano commands/PoizonImportJsonController.php

# –ó–∞–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ actionRun (—Å–º. –†–ï–®–ï–ù–ò–ï #2 –≤—ã—à–µ)
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –¢–µ—Å—Ç —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º URL (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞)
php yii poizon-import-json/run "https://example.com/nonexistent.json"
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: "‚ùå URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
```

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (2 –º–∏–Ω—É—Ç—ã)

```bash
# –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
nano config/params.php

# –í—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (A, B –∏–ª–∏ C) –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
# –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ XML URL (–í–∞—Ä–∏–∞–Ω—Ç A)
php yii import/products

# –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ API (–í–∞—Ä–∏–∞–Ω—Ç B)
php yii poizon-import/run --limit=10

# –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã (–í–∞—Ä–∏–∞–Ω—Ç C)
php yii poizon-import-json/run "URL_TO_JSON"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –∏–º–ø–æ—Ä—Ç–∞

### ‚úÖ –ú–µ—Ç–æ–¥ 1: –ò–º–ø–æ—Ä—Ç –∏–∑ XML —Ñ–∏–¥–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: `poizonXmlUrl` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ params.php

```bash
# –ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç
php yii import/products

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º URL
php yii import/products "https://your-xml-feed.com/products.xml"
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç XML —Ñ–∏–¥
- –ü–∞—Ä—Å–∏—Ç —Ç–æ–≤–∞—Ä—ã, –±—Ä–µ–Ω–¥—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã
- –°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ

---

### ‚úÖ –ú–µ—Ç–æ–¥ 2: –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ API

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: `poizonApiKey` –∏ `poizonApiUrl` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

```bash
# –ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –ª–∏–º–∏—Ç—É)
php yii poizon-import/run --limit=100

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î)
php yii poizon-import/run --limit=10 --dryRun=1

# –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã
php yii poizon-import/update-prices

# –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã
php yii poizon-import/update-sizes
```

---

### ‚úÖ –ú–µ—Ç–æ–¥ 3: –ò–º–ø–æ—Ä—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: JSON —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ Poizon Export

```bash
# –ò–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ URL
php yii poizon-import-json/run "https://storage.yandexcloud.net/.../export_04_11_2025__15_32_15.json"

# –ò–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
php yii poizon-import-json/run "/tmp/poizon_export.json"
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±—Ä–µ–Ω–¥—ã —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏
- –°–æ–∑–¥–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã
- –°–æ–∑–¥–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã (children) –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü–∞—Ä—Å–∏—Ç –≤—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

---

### ‚úÖ –ú–µ—Ç–æ–¥ 4: –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**URL**: `http://localhost:8080/admin/poizon-run`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
1. –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ò–º–ø–æ—Ä—Ç Poizon ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç
2. Drag & Drop JSON —Ñ–∞–π–ª–∞ –≤ –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
3. –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"
4. –ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò–º–ø–æ—Ä—Ç Poizon" ‚Üí –ò—Å—Ç–æ—Ä–∏—è

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã**:
- JSON (Poizon Export format)
- CSV
- Excel (.xlsx, .xls)

---

## üìä –ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –ú–µ—Ç–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|-------|-------------------|-------|--------|
| **JSON —Ñ–∞–π–ª** | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | –ü–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –≤–∞—Ä–∏–∞–Ω—Ç—ã | –ù—É–∂–µ–Ω —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∞ |
| **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** | –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ | –£–¥–æ–±–Ω—ã–π UI, Drag & Drop | –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ |
| **XML —Ñ–∏–¥** | –ï—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∏–¥—É | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –ú–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª–µ–π |
| **API** | –ï—Å—Ç—å API –∫–ª—é—á | Real-time –¥–∞–Ω–Ω—ã–µ | –¢—Ä–µ–±—É–µ—Ç –ø–ª–∞—Ç–Ω–æ–≥–æ API |

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¥–ª—è –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã—Ö)

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (2 –º–∏–Ω—É—Ç—ã)

1. **–î–æ–±–∞–≤–∏—Ç—å poizonApi –≤ console.php** (—Å–º. –†–ï–®–ï–ù–ò–ï #1)
2. **–°–∫–∞—á–∞—Ç—å JSON —Ñ–∞–π–ª —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º Poizon**
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç**:

```bash
php yii poizon-import-json/run "/–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.json"
```

–ì–æ—Ç–æ–≤–æ! –¢–æ–≤–∞—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ poizonApi
php yii poizon-import/test

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Unknown component ID" ‚Üí –Ω—É–∂–Ω–æ –†–ï–®–ï–ù–ò–ï #1
# –ï—Å–ª–∏ "Poizon XML URL not configured" ‚Üí –Ω—É–∂–Ω–æ –†–ï–®–ï–ù–ò–ï #3 (–í–∞—Ä–∏–∞–Ω—Ç A –∏–ª–∏ C)
# –ï—Å–ª–∏ "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ" ‚Üí –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON –∏–º–ø–æ—Ä—Ç
php yii poizon-import-json/run "https://httpbin.org/status/404"

# –ï—Å–ª–∏ –Ω–µ–∫—Ä–∞—Å–∏–≤–∞—è –æ—à–∏–±–∫–∞ PHP Warning ‚Üí –Ω—É–∂–Ω–æ –†–ï–®–ï–ù–ò–ï #2
# –ï—Å–ª–∏ "‚ùå URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" ‚Üí –†–ï–®–ï–ù–ò–ï #2 —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
cat config/params.php | grep poizon

# –ï—Å–ª–∏ –≤—Å–µ null ‚Üí –Ω—É–∂–Ω–æ –†–ï–®–ï–ù–ò–ï #3
```

---

## üìù –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω config/console.php** - –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç poizonApi
- [ ] **–£–ª—É—á—à–µ–Ω PoizonImportJsonController** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] **–ù–∞—Å—Ç—Ä–æ–µ–Ω config/params.php** - –∑–∞–ø–æ–ª–Ω–µ–Ω—ã poizonXmlUrl –∏–ª–∏ poizonApiKey
- [ ] **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏–º–ø–æ—Ä—Ç** - php yii poizon-import/test
- [ ] **–ü—Ä–æ–≤–µ–¥–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç** - –∑–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤
- [ ] **–ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤–µ–±-–ø–∞–Ω–µ–ª—å** - /admin/poizon-import —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéâ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ë—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# API –∏–º–ø–æ—Ä—Ç
php yii poizon-import/run --limit=100
php yii poizon-import/test
php yii poizon-import/update-prices
php yii poizon-import/logs

# JSON –∏–º–ø–æ—Ä—Ç
php yii poizon-import-json/run "URL_OR_PATH"

# XML –∏–º–ø–æ—Ä—Ç
php yii import/products

# –§–∞–π–ª–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç (—á–µ—Ä–µ–∑ from-file)
php yii poizon-import/from-file "/path/to/file.json"
```

### –ë—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

- `/admin/poizon-import` - –∏—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤
- `/admin/poizon-run` - –∑–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞
- `/admin/poizon-view/{id}` - –¥–µ—Ç–∞–ª–∏ –∏–º–ø–æ—Ä—Ç–∞
- `/admin/poizon-errors` - –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û—à–∏–±–∫–∞: "Unknown component ID: poizonApi"
‚Üí –ü—Ä–∏–º–µ–Ω–∏—Ç—å **–†–ï–®–ï–ù–ò–ï #1**

### –û—à–∏–±–∫–∞: "file_get_contents(...): Failed to open stream"
‚Üí –ü—Ä–∏–º–µ–Ω–∏—Ç—å **–†–ï–®–ï–ù–ò–ï #2** –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å URL —Ñ–∞–π–ª–∞

### –û—à–∏–±–∫–∞: "Poizon XML URL not configured"
‚Üí –ü—Ä–∏–º–µ–Ω–∏—Ç—å **–†–ï–®–ï–ù–ò–ï #3** (–í–∞—Ä–∏–∞–Ω—Ç A –∏–ª–∏ C)

### –û—à–∏–±–∫–∞: "API request failed"
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å poizonApiKey –∏ poizonApiUrl –≤ params.php

### –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ–∑ —Ç–æ–≤–∞—Ä–æ–≤
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç JSON —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å products[], brands[], categories[])

---

**–ê–≤—Ç–æ—Ä**: Cascade AI Assistant  
**–î–∞—Ç–∞**: 04.11.2024  
**–í–µ—Ä—Å–∏—è**: 1.0
